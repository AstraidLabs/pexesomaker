<!DOCTYPE html>
<html lang="cs" id="html-root">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pexeso Maker</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root {
  --bg: #FFF8F0;
  --ink: #1C1917;
  --orange: #F97316;
  --teal: #0D9488;
  --red: #EF4444;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--ink);
  min-height: 100vh;
}
body::before {
  content: '';
  position: fixed; inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E");
  pointer-events: none; z-index: 0;
}

/* HEADER */
.header {
  background: var(--ink); color: #FFF8F0;
  padding: 0.8rem 1.5rem;
  display: flex; align-items: center; gap: 0.8rem;
  position: relative; z-index: 10;
  border-bottom: 4px solid var(--orange);
}
.header-logo {
  font-family: 'Baloo 2', cursive; font-size: 1.5rem; font-weight: 800;
  display: flex; align-items: center; gap: 0.5rem;
}
.scissors-icon {
  background: var(--orange); color: white;
  width: 36px; height: 36px; border-radius: 9px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem; transform: rotate(-15deg); transition: transform 0.3s;
}
.header-logo:hover .scissors-icon { transform: rotate(15deg); }
.header-sub { font-size: 0.75rem; color: #aaa; font-weight: 500; }

/* LANGUAGE SWITCHER */
.lang-switcher {
  margin-left: auto;
  display: flex; align-items: center; gap: 4px;
}
.lang-btn {
  background: none; border: 2px solid transparent;
  border-radius: 7px; cursor: pointer;
  font-size: 0.78rem; font-weight: 700; line-height: 1;
  color: rgba(255,255,255,0.55);
  padding: 4px 7px;
  transition: all 0.15s;
  letter-spacing: 0.3px;
  font-family: 'DM Sans', sans-serif;
}
.lang-btn:hover { color: white; background: rgba(255,255,255,0.1); }
.lang-btn.active {
  color: white;
  border-color: var(--orange);
  background: rgba(249,115,22,0.2);
}

/* HAMBURGER (mobile only) */
.hamburger {
  display: none;
  background: none; border: none; cursor: pointer;
  color: white; padding: 6px; border-radius: 8px;
  transition: background 0.15s; order: -1;
}
.hamburger:hover { background: rgba(255,255,255,0.1); }
.hamburger svg { display: block; }

/* SIDEBAR OVERLAY (mobile) */
.sidebar-overlay {
  display: none;
  position: fixed; inset: 0; z-index: 199;
  background: rgba(28,25,23,0.5);
  backdrop-filter: blur(2px);
}
.sidebar-overlay.visible { display: block; }

/* SIDEBAR CLOSE BUTTON (mobile) */
.sidebar-close {
  display: none;
  position: absolute; top: 0.8rem; right: 0.8rem;
  background: #F3F4F6; border: none; border-radius: 50%;
  width: 30px; height: 30px; cursor: pointer;
  font-size: 0.85rem; color: #666;
  align-items: center; justify-content: center;
  transition: background 0.15s; z-index: 10;
}
.sidebar-close:hover { background: #E5E7EB; }

/* LAYOUT */
.app {
  display: grid;
  grid-template-columns: 330px 1fr;
  min-height: calc(100vh - 65px);
  position: relative; z-index: 1;
}

/* SIDEBAR */
.sidebar {
  background: white;
  border-right: 2px solid #E8E0D8;
  padding: 1.2rem;
  display: flex; flex-direction: column; gap: 0;
  overflow-y: auto;
  max-height: calc(100vh - 65px);
  position: sticky; top: 65px; align-self: start;
}
.sidebar::-webkit-scrollbar { width: 3px; }
.sidebar::-webkit-scrollbar-thumb { background: #E0D8D0; border-radius: 4px; }

/* MOBILE BOTTOM ACTION BAR */
.mobile-actions {
  display: none;
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 150;
  background: white;
  border-top: 2px solid #E8E0D8;
  padding: 0.7rem 1rem;
  gap: 0.5rem;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
}
.mobile-actions .btn {
  flex: 1; padding: 0.65rem 0.5rem; font-size: 0.82rem;
}

/* â”€â”€ TABLET: 768pxâ€“1024px â”€â”€ */
@media (max-width: 1024px) and (min-width: 769px) {
  .app { grid-template-columns: 280px 1fr; }
  .header-sub { display: none; }
}

/* â”€â”€ MOBILE: â‰¤ 768px â”€â”€ */
@media (max-width: 768px) {
  /* Header */
  .header { padding: 0.7rem 1rem; gap: 0.5rem; }
  .header-logo { font-size: 1.2rem; }
  .scissors-icon { width: 30px; height: 30px; font-size: 0.95rem; }
  .header-sub { display: none; }
  .lang-btn { font-size: 0.7rem; padding: 3px 5px; }
  .hamburger { display: flex; }

  /* Layout: single column, sidebar hidden */
  .app { grid-template-columns: 1fr; }

  /* Sidebar becomes a slide-in drawer */
  .sidebar {
    position: fixed;
    top: 0; left: 0; bottom: 0;
    width: min(85vw, 340px);
    max-height: 100vh;
    z-index: 200;
    transform: translateX(-110%);
    transition: transform 0.28s cubic-bezier(0.4, 0, 0.2, 1);
    border-right: 2px solid #E8E0D8;
    padding-top: 3rem;
    box-shadow: 4px 0 30px rgba(0,0,0,0.15);
  }
  .sidebar.open { transform: translateX(0); }
  .sidebar-close { display: flex; }

  /* Main takes full width, add bottom padding for action bar */
  .main { padding: 1rem; padding-bottom: 80px; }

  /* Sheets fit on screen */
  .sheets-wrapper { gap: 1.5rem; }
  .sheet-block { border-radius: 10px; }
  .sheet-header { flex-wrap: wrap; gap: 0.4rem; padding: 0.6rem 0.8rem; }
  .sheet-tip { margin-left: 0; }
  .sheet-body { padding: 0.7rem; }

  /* Cut grid: allow horizontal scroll */
  .cut-outer { overflow-x: auto; -webkit-overflow-scrolling: touch; }

  /* Empty state */
  .empty-state { min-height: 60vh; }
  .empty-state .big { font-size: 3rem; }
  .empty-state h2 { font-size: 1.3rem; }

  /* Hide btn-row in sidebar on mobile (moved to bottom bar) */
  .btn-row { display: none; }

  /* Show mobile action bar */
  .mobile-actions { display: flex; }

  /* Thumb grid: 5 columns when sidebar is wide */
  .thumb-grid { grid-template-columns: repeat(5, 1fr); }

  /* Warn/PDF overlays: full screen on small phones */
  .warn-box { padding: 1.5rem 1.2rem; border-radius: 16px; }
  .pdf-overlay-box { padding: 2rem 1.5rem; min-width: unset; width: 85vw; }
}

/* â”€â”€ VERY SMALL: â‰¤ 380px â”€â”€ */
@media (max-width: 380px) {
  .lang-btn { padding: 2px 4px; font-size: 0.65rem; }
  .mobile-actions .btn { font-size: 0.72rem; padding: 0.55rem 0.3rem; }
}

/* ACCORDION */
.acc-section { border-bottom: 1px solid #F0EBE5; }
.acc-header {
  display: flex; align-items: center; gap: 0.5rem;
  padding: 0.75rem 0;
  cursor: pointer; user-select: none;
  font-family: 'Baloo 2', cursive;
  font-size: 0.78rem; font-weight: 700;
  letter-spacing: 1px; text-transform: uppercase; color: #9CA3AF;
  transition: color 0.15s;
}
.acc-header:hover { color: var(--orange); }
.acc-header .num {
  width: 20px; height: 20px; border-radius: 6px;
  background: #F3F4F6; color: var(--ink);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.7rem; font-weight: 800; flex-shrink: 0;
}
.acc-header .num.done { background: var(--orange); color: white; }
.acc-chevron { margin-left: auto; font-size: 0.65rem; color: #ccc; transition: transform 0.2s; }
.acc-section.open .acc-chevron { transform: rotate(90deg); }
.acc-body { display: none; padding-bottom: 1rem; }
.acc-section.open .acc-body { display: block; }

/* DROPZONE */
.dropzone {
  border: 2px dashed #D1C7BD; border-radius: 12px;
  padding: 1.2rem 0.8rem; text-align: center;
  cursor: pointer; transition: all 0.2s; background: var(--bg);
}
.dropzone:hover, .dropzone.over { border-color: var(--orange); background: #FFF3E8; }
.dropzone input { display: none; }
.dropzone p { font-size: 0.8rem; color: #888; line-height: 1.4; margin-top: 0.25rem; }
.dropzone strong { color: var(--orange); }

/* THUMBS */
.thumb-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 0.5rem; }
.thumb { aspect-ratio: 1; border-radius: 7px; overflow: hidden; position: relative; border: 2px solid #E8E0D8; }
.thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
.thumb .del {
  position: absolute; top: 2px; right: 2px;
  width: 16px; height: 16px; background: var(--red); color: white;
  border: none; border-radius: 50%; font-size: 0.55rem; font-weight: 900;
  cursor: pointer; display: none; align-items: center; justify-content: center;
}
.thumb:hover .del { display: flex; }
.counter-bar { font-size: 0.78rem; color: #888; font-weight: 600; text-align: center; margin-top: 0.3rem; }
.counter-bar span { color: var(--orange); font-weight: 800; }

/* TABS */
.tabs { display: flex; border: 2px solid #E8E0D8; border-radius: 9px; overflow: hidden; }
.tab-btn {
  flex: 1; padding: 0.45rem; border: none; background: white;
  font-family: 'DM Sans', sans-serif; font-size: 0.8rem; font-weight: 600;
  cursor: pointer; color: #888; transition: all 0.15s;
}
.tab-btn.active { background: var(--ink); color: white; }
.tab-content { display: none; margin-top: 0.6rem; }
.tab-content.active { display: block; }

/* SWATCHES */
.swatch-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 7px; }
.swatch {
  aspect-ratio: 1; border-radius: 9px; cursor: pointer;
  border: 3px solid transparent; transition: all 0.15s; overflow: hidden; position: relative;
}
.swatch:hover { transform: scale(1.05); }
.swatch.active { border-color: var(--ink); box-shadow: 0 0 0 2px var(--ink); }
.swatch-label {
  position: absolute; bottom: 2px; left: 0; right: 0;
  text-align: center; font-size: 0.55rem; font-weight: 700;
  color: rgba(255,255,255,0.9); text-shadow: 0 1px 3px rgba(0,0,0,0.6);
}

/* BACK DROPZONE */
.back-dz {
  border: 2px dashed #D1C7BD; border-radius: 10px;
  padding: 1rem 0.7rem; text-align: center; cursor: pointer;
  background: var(--bg); transition: all 0.2s;
}
.back-dz:hover { border-color: var(--teal); background: #F0FDFB; }
.back-dz input { display: none; }
.back-preview {
  width: 100%; height: 72px; border-radius: 7px; object-fit: cover;
  margin-top: 0.4rem; display: none; border: 2px solid #E8E0D8;
}

/* FORM */
.field { margin-bottom: 0.7rem; }
.field label {
  display: flex; justify-content: space-between; align-items: center;
  font-size: 0.74rem; font-weight: 600; color: #666;
  margin-bottom: 0.25rem; letter-spacing: 0.4px;
}
.field label .val {
  font-size: 0.78rem; font-weight: 800; color: var(--orange);
  background: #FFF3E8; padding: 0.1rem 0.45rem; border-radius: 5px;
  min-width: 36px; text-align: center;
}
.field input[type="text"], .field select {
  width: 100%; padding: 0.48rem 0.75rem;
  border-radius: 9px; border: 2px solid #E8E0D8;
  font-family: 'DM Sans', sans-serif; font-size: 0.88rem;
  font-weight: 500; background: white; outline: none; transition: border-color 0.2s;
}
.field input:focus, .field select:focus { border-color: var(--orange); }

input[type="range"] {
  -webkit-appearance: none; width: 100%; height: 5px;
  border-radius: 3px; background: #E8E0D8; outline: none; cursor: pointer;
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none; width: 16px; height: 16px;
  border-radius: 50%; background: var(--orange);
  border: 2px solid white; box-shadow: 0 1px 4px rgba(0,0,0,0.25); cursor: pointer;
}

/* ICON BUTTON GROUP */
.btn-group { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
.icon-btn {
  padding: 0.45rem 0.2rem; border: 2px solid #E8E0D8; border-radius: 8px;
  background: white; cursor: pointer; text-align: center;
  font-size: 0.65rem; font-weight: 700; color: #888; transition: all 0.15s;
  display: flex; flex-direction: column; align-items: center; gap: 3px;
}
.icon-btn:hover { border-color: var(--orange); color: var(--orange); }
.icon-btn.active { border-color: var(--orange); background: #FFF3E8; color: var(--orange); }

/* TOGGLE */
.toggle-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem; }
.toggle-label { font-size: 0.74rem; font-weight: 600; color: #666; }
.toggle {
  width: 38px; height: 22px; border-radius: 11px;
  background: #E8E0D8; position: relative; cursor: pointer;
  transition: background 0.2s; flex-shrink: 0; border: none;
}
.toggle::after {
  content: ''; position: absolute; top: 3px; left: 3px;
  width: 16px; height: 16px; border-radius: 50%; background: white;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2); transition: left 0.2s;
}
.toggle.on { background: var(--orange); }
.toggle.on::after { left: 19px; }

.color-row { display: flex; align-items: center; gap: 8px; margin-bottom: 0.7rem; }
.color-row label { font-size: 0.74rem; font-weight: 600; color: #666; flex: 1; }
input[type="color"] {
  width: 34px; height: 28px; border-radius: 7px; border: 2px solid #E8E0D8;
  cursor: pointer; padding: 2px; background: white;
}

/* CARD PREVIEW */
.card-preview-wrap {
  display: flex; flex-direction: column; align-items: center; gap: 0.5rem;
  padding: 0.8rem; background: #F8F5F2; border-radius: 10px; margin-bottom: 0.7rem;
}
.card-preview-label { font-size: 0.7rem; font-weight: 700; color: #aaa; text-transform: uppercase; letter-spacing: 1px; }
.card-preview-box { width: 90px; height: 90px; position: relative; }
#card-mini { position: absolute; inset: 0; transition: all 0.2s; }
#card-mini-inner {
  position: absolute; inset: 0;
  background: linear-gradient(135deg, #ddd 0%, #eee 100%);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.4rem; transition: all 0.2s;
}

/* BUTTONS */
.btn {
  width: 100%; padding: 0.7rem 1rem; border-radius: 11px; border: none;
  font-family: 'Baloo 2', cursive; font-size: 1rem; font-weight: 700;
  cursor: pointer; transition: all 0.18s;
  display: flex; align-items: center; justify-content: center; gap: 0.5rem;
}
.btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
.btn:active { transform: translateY(0); }
.btn-generate { background: var(--orange); color: white; }
.btn-pdf { background: linear-gradient(135deg, #7C3AED, #A855F7); color: white; }
.btn-print { background: var(--ink); color: white; }
.btn-clear { background: #F3F4F6; color: #666; }
.btn-clear:hover { box-shadow: none; transform: none; background: #E5E7EB; }
.btn-row { display: flex; flex-direction: column; gap: 0.45rem; padding: 0.8rem 0; }
.divider { height: 1px; background: #F0EBE5; }

/* MAIN */
.main { padding: 1.8rem; overflow-y: auto; }
.empty-state {
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; min-height: 500px; text-align: center; color: #C4BAB0;
}
.empty-state .big { font-size: 4.5rem; }
.empty-state h2 { font-family: 'Baloo 2', cursive; font-size: 1.7rem; margin: 0.5rem 0 0.3rem; color: #D6CECA; }
.empty-state p { font-size: 0.88rem; }

/* SHEET BLOCK */
.sheets-wrapper { display: flex; flex-direction: column; gap: 2.5rem; }
.sheet-block { background: white; border-radius: 14px; box-shadow: 0 4px 30px rgba(0,0,0,0.08); border: 1px solid #E8E0D8; overflow: hidden; }
.sheet-header {
  display: flex; align-items: center; gap: 0.7rem;
  padding: 0.8rem 1.2rem; border-bottom: 2px solid #F3F4F6; background: #FAFAF9;
}
.sheet-badge {
  background: var(--orange); color: white;
  font-family: 'Baloo 2', cursive; font-size: 0.75rem; font-weight: 700;
  padding: 0.2rem 0.65rem; border-radius: 50px;
}
.sheet-badge.back { background: var(--teal); }
.sheet-info { font-size: 0.8rem; color: #888; }
.sheet-tip { margin-left: auto; font-size: 0.75rem; background: #FFF3E8; color: var(--orange); padding: 0.2rem 0.65rem; border-radius: 50px; font-weight: 600; }
.sheet-tip.back { background: #F0FDFB; color: var(--teal); }
.sheet-body { padding: 1.2rem; }

/* CUT GRID */
.cut-outer { display: flex; gap: 0; align-items: flex-start; overflow-x: auto; }
.scissors-margin { display: flex; flex-direction: column; }
.scissors-row { display: flex; align-items: center; justify-content: center; color: #CCC; font-size: 0.8rem; flex-shrink: 0; }
.col-scissors { display: flex; }
.col-scissors-cell { display: flex; align-items: center; justify-content: center; color: #CCC; font-size: 0.8rem; flex-shrink: 0; padding: 3px 0; }
.cut-grid { display: grid; border-top: 2px dashed #BBBBB5; border-left: 2px dashed #BBBBB5; }
/* Row-based layout for print safety */
.cut-grid-wrap { border-top: 2px dashed #BBBBB5; border-left: 2px dashed #BBBBB5; display: inline-block; }
.cut-row {
  display: flex;
  break-inside: avoid;
  page-break-inside: avoid;
}
.grid-cell { position: relative; overflow: visible; border-right: 2px dashed #BBBBB5; border-bottom: 2px dashed #BBBBB5; display: flex; align-items: center; justify-content: center; }
.grid-cell::before, .grid-cell::after { content: ''; position: absolute; width: 5px; height: 5px; border-radius: 50%; background: rgba(170,170,165,0.5); z-index: 2; }
.grid-cell::before { top: 0; left: 0; transform: translate(-50%,-50%); }
.grid-cell::after { bottom: 0; right: 0; transform: translate(50%,50%); }
.card-body { position: absolute; overflow: hidden; transition: all 0.15s; }
.card-body img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; display: block; pointer-events: none; }

.print-note { margin-top: 0.7rem; padding: 0.6rem 0.9rem; background: #FFF8F0; border-left: 3px solid var(--orange); border-radius: 0 7px 7px 0; font-size: 0.79rem; color: #666; line-height: 1.5; }
.print-note strong { color: var(--ink); }

/* TOAST */
.toast {
  position: fixed; bottom: 2rem; left: 50%;
  transform: translateX(-50%) translateY(8px);
  background: var(--ink); color: white;
  padding: 0.6rem 1.3rem; border-radius: 50px;
  font-weight: 600; font-size: 0.85rem;
  opacity: 0; transition: all 0.3s; pointer-events: none; z-index: 9999;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* WARNING MODAL */
.warn-overlay {
  position: fixed; inset: 0; background: rgba(28,25,23,0.65); backdrop-filter: blur(3px);
  z-index: 88888; display: none; align-items: center; justify-content: center;
}
.warn-overlay.visible { display: flex; }
.warn-box { background: white; border-radius: 20px; padding: 2rem 2.2rem; max-width: 360px; width: 90%; box-shadow: 0 16px 50px rgba(0,0,0,0.3); text-align: center; }
.warn-box .warn-icon { font-size: 2.8rem; margin-bottom: 0.6rem; }
.warn-box h3 { font-family: 'Baloo 2', cursive; font-size: 1.2rem; color: #1C1917; margin-bottom: 0.5rem; }
.warn-box p { font-size: 0.85rem; color: #666; line-height: 1.55; margin-bottom: 1.3rem; }
.warn-box p strong { color: #D97706; }
.warn-actions { display: flex; gap: 0.6rem; }
.warn-actions .btn { font-size: 0.9rem; padding: 0.6rem 0.8rem; }
.btn-warn-cancel { background: #F3F4F6; color: #666; }
.btn-warn-cancel:hover { background: #E5E7EB; box-shadow: none; transform: none; }
.btn-warn-proceed { background: #D97706; color: white; flex: 1; }

/* PDF OVERLAY */
.pdf-overlay {
  position: fixed; inset: 0; background: rgba(28,25,23,0.75); backdrop-filter: blur(4px);
  z-index: 99999; display: none; flex-direction: column; align-items: center; justify-content: center; gap: 1.2rem;
}
.pdf-overlay.visible { display: flex; }
.pdf-overlay-box { background: white; border-radius: 20px; padding: 2.5rem 3rem; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.4); min-width: 280px; }
.pdf-overlay-box .pdf-icon { font-size: 3rem; margin-bottom: 0.5rem; }
.pdf-overlay-box h3 { font-family: 'Baloo 2', cursive; font-size: 1.3rem; color: #1C1917; margin-bottom: 0.4rem; }
.pdf-overlay-box .pdf-sub { font-size: 0.84rem; color: #999; margin-bottom: 1.2rem; }
.pdf-progress-track { width: 100%; height: 8px; background: #F3F4F6; border-radius: 4px; overflow: hidden; margin-bottom: 0.5rem; }
.pdf-progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #7C3AED, #A855F7); border-radius: 4px; transition: width 0.4s ease; }
.pdf-progress-label { font-size: 0.78rem; font-weight: 700; color: #7C3AED; }

/* PRINT */
@media print {
  @page { margin: 8mm; size: A4; }
  body { background: white !important; }
  body::before { display: none !important; }
  .header, .sidebar, .sheet-header, .print-note, .toast, .mobile-actions, .sidebar-overlay { display: none !important; }
  .app { display: block !important; }
  .main { padding: 0 !important; overflow: visible !important; }
  .sheets-wrapper { gap: 0 !important; }
  .sheet-block { box-shadow: none !important; border: none !important; border-radius: 0 !important; page-break-after: always; break-after: page; }
  .sheet-block:last-child { page-break-after: avoid; break-after: avoid; }
  .sheet-body { padding: 0 !important; }
  .cut-grid, .cut-grid-wrap { border-color: #999 !important; print-color-adjust: exact; -webkit-print-color-adjust: exact; }
  .cut-row { break-inside: avoid !important; page-break-inside: avoid !important; }
  .grid-cell { border-color: #999 !important; print-color-adjust: exact; -webkit-print-color-adjust: exact; }
  .card-body { print-color-adjust: exact; -webkit-print-color-adjust: exact; }
  .scissors-row, .col-scissors-cell { color: #999 !important; }
  .cut-outer { overflow-x: visible !important; }
}
</style>
</head>
<body>

<div class="header">
  <button class="hamburger" onclick="toggleSidebar()" aria-label="Menu">
    <svg width="22" height="22" fill="none" stroke="white" stroke-width="2" stroke-linecap="round">
      <line x1="3" y1="6" x2="19" y2="6"/><line x1="3" y1="11" x2="19" y2="11"/><line x1="3" y1="16" x2="19" y2="16"/>
    </svg>
  </button>
  <div class="header-logo">
    <div class="scissors-icon">âœ‚</div>
    Pexeso Maker
  </div>
  <span class="header-sub" data-i18n="header_sub"></span>
  <div class="lang-switcher">
    <button class="lang-btn active" data-lang="cs" onclick="setLang('cs')" title="ÄŒeÅ¡tina">CS</button>
    <button class="lang-btn" data-lang="en" onclick="setLang('en')" title="English">EN</button>
    <button class="lang-btn" data-lang="sk" onclick="setLang('sk')" title="SlovenÄina">SK</button>
    <button class="lang-btn" data-lang="pl" onclick="setLang('pl')" title="Polski">PL</button>
    <button class="lang-btn" data-lang="de" onclick="setLang('de')" title="Deutsch">DE</button>
  </div>
</div>

<div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>
<div class="app">
<div class="sidebar" id="sidebar">
  <button class="sidebar-close" onclick="closeSidebar()">âœ•</button>
  <!-- â‘  Images -->
  <div class="acc-section open" id="sec-1">
    <div class="acc-header" onclick="toggleAcc('sec-1')">
      <span class="num done" id="num-1">1</span>
      <span data-i18n="sec1_title"></span>
      <span class="acc-chevron">â–¶</span>
    </div>
    <div class="acc-body">
      <div class="dropzone" id="front-dz">
        <input type="file" id="front-input" accept="image/*" multiple>
        <div style="font-size:1.6rem">ğŸ–¼ï¸</div>
        <p data-i18n-html="dropzone_text"></p>
      </div>
      <div class="thumb-grid" id="thumb-grid"></div>
      <div class="counter-bar" id="counter-bar" style="display:none">
        <span id="img-count">0</span> <span data-i18n="counter_imgs"></span> â†’ <span id="card-count">0</span> <span data-i18n="counter_cards"></span>
      </div>
    </div>
  </div>

  <!-- â‘¡ Back side -->
  <div class="acc-section open" id="sec-2">
    <div class="acc-header" onclick="toggleAcc('sec-2')">
      <span class="num" id="num-2">2</span>
      <span data-i18n="sec2_title"></span>
      <span class="acc-chevron">â–¶</span>
    </div>
    <div class="acc-body">
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('preset')" data-i18n="tab_preset"></button>
        <button class="tab-btn" onclick="switchTab('custom')" data-i18n="tab_custom"></button>
      </div>
      <div class="tab-content active" id="tab-preset">
        <div class="swatch-grid" id="swatch-grid"></div>
      </div>
      <div class="tab-content" id="tab-custom">
        <div class="back-dz" id="back-dz">
          <input type="file" id="back-input" accept="image/*">
          <div style="font-size:1.4rem">ğŸ¨</div>
          <p style="font-size:0.78rem;color:#888;margin-top:0.25rem" data-i18n="back_upload_hint"></p>
        </div>
        <img id="back-preview" class="back-preview" alt="preview">
        <div id="back-remove-btn" style="display:none;text-align:center;margin-top:0.3rem">
          <button onclick="removeBackImage()" style="font-size:0.76rem;color:var(--red);border:none;background:none;cursor:pointer;font-weight:600" data-i18n="back_remove"></button>
        </div>
      </div>
    </div>
  </div>

  <!-- â‘¢ Layout -->
  <div class="acc-section open" id="sec-3">
    <div class="acc-header" onclick="toggleAcc('sec-3')">
      <span class="num" id="num-3">3</span>
      <span data-i18n="sec3_title"></span>
      <span class="acc-chevron">â–¶</span>
    </div>
    <div class="acc-body">
      <div class="field">
        <label data-i18n="field_title"></label>
        <input type="text" id="game-title" data-i18n-placeholder="default_title">
      </div>
      <div class="field">
        <label data-i18n="field_cols"></label>
        <select id="cols-select">
          <option value="3" data-i18n="col_3"></option>
          <option value="4" selected data-i18n="col_4"></option>
          <option value="5" data-i18n="col_5"></option>
          <option value="6" data-i18n="col_6"></option>
        </select>
      </div>
      <div class="field">
        <label><span data-i18n="field_size"></span><span class="val" id="size-val">110 px</span></label>
        <input type="range" id="size-select" min="70" max="250" value="110" step="5" oninput="onSlider(this,'size-val','px');updatePreview()">
      </div>

      <div class="field">
        <label data-i18n="field_pdf_orient"></label>
        <div class="btn-group" id="orient-group" style="grid-template-columns:1fr 1fr;margin-top:0.3rem">
          <button class="icon-btn active" data-val="portrait" onclick="setOrient(this)">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none">
              <rect x="5" y="2" width="12" height="18" rx="2" stroke="#333" stroke-width="1.8"/>
              <line x1="7.5" y1="7" x2="14.5" y2="7" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
              <line x1="7.5" y1="10" x2="14.5" y2="10" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
              <line x1="7.5" y1="13" x2="11.5" y2="13" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
            <span data-i18n="orient_portrait"></span>
          </button>
          <button class="icon-btn" data-val="landscape" onclick="setOrient(this)">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none">
              <rect x="2" y="5" width="18" height="12" rx="2" stroke="#333" stroke-width="1.8"/>
              <line x1="6" y1="8.5" x2="16" y2="8.5" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
              <line x1="6" y1="11" x2="16" y2="11" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
              <line x1="6" y1="13.5" x2="11" y2="13.5" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
            <span data-i18n="orient_landscape"></span>
          </button>
        </div>
      </div>

    </div><!-- end acc-body sec-3 -->
  </div><!-- end acc-section sec-3 -->

  <!-- â‘£ Card style -->
  <div class="acc-section open" id="sec-4">
    <div class="acc-header" onclick="toggleAcc('sec-4')">
      <span class="num" id="num-4">4</span>
      <span data-i18n="sec4_title"></span>
      <span class="acc-chevron">â–¶</span>
    </div>
    <div class="acc-body">
      <div class="card-preview-wrap">
        <div class="card-preview-label" data-i18n="preview_label"></div>
        <div class="card-preview-box">
          <div id="card-mini"><div id="card-mini-inner">ğŸ´</div></div>
        </div>
      </div>

      <div class="field" style="margin-bottom:0.5rem">
        <label data-i18n="field_border_style"></label>
        <div class="btn-group" id="border-style-group" style="margin-top:0.3rem">
          <button class="icon-btn active" data-val="none" onclick="setBorderStyle(this)">
            <svg width="24" height="24"><rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="#ccc" stroke-width="1.5" stroke-dasharray="2 2"/></svg>
            <span data-i18n="bs_none"></span>
          </button>
          <button class="icon-btn" data-val="solid" onclick="setBorderStyle(this)">
            <svg width="24" height="24"><rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="#333" stroke-width="2"/></svg>
            <span data-i18n="bs_solid"></span>
          </button>
          <button class="icon-btn" data-val="dashed" onclick="setBorderStyle(this)">
            <svg width="24" height="24"><rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="#333" stroke-width="2" stroke-dasharray="4 2"/></svg>
            <span data-i18n="bs_dashed"></span>
          </button>
          <button class="icon-btn" data-val="hatched" onclick="setBorderStyle(this)">
            <svg width="24" height="24"><rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="#333" stroke-width="1.5"/><line x1="4" y1="14" x2="14" y2="4" stroke="#333" stroke-width="1"/><line x1="10" y1="20" x2="20" y2="10" stroke="#333" stroke-width="1"/></svg>
            <span data-i18n="bs_hatched"></span>
          </button>
        </div>
      </div>

      <div class="field" id="border-thickness-field">
        <label><span data-i18n="field_border_w"></span><span class="val" id="border-w-val">2 px</span></label>
        <input type="range" id="border-w" min="1" max="12" value="2" step="1" oninput="onSlider(this,'border-w-val','px');updatePreview()">
      </div>
      <div class="color-row" id="border-color-field">
        <label data-i18n="field_border_color"></label>
        <input type="color" id="border-color" value="#222222" oninput="updatePreview()">
      </div>

      <div class="divider" style="margin-bottom:0.7rem"></div>

      <div class="field">
        <label><span data-i18n="field_inner_pad"></span><span class="val" id="inner-pad-val">4 px</span></label>
        <input type="range" id="inner-pad" min="0" max="24" value="4" step="1" oninput="onSlider(this,'inner-pad-val','px');updatePreview()">
      </div>
      <div class="field">
        <label><span data-i18n="field_outer_mar"></span><span class="val" id="outer-mar-val">4 px</span></label>
        <input type="range" id="outer-mar" min="0" max="20" value="4" step="1" oninput="onSlider(this,'outer-mar-val','px');updatePreview()">
      </div>
      <div class="field">
        <label><span data-i18n="field_gap"></span><span class="val" id="gap-val">0 px</span></label>
        <input type="range" id="card-gap" min="0" max="30" value="0" step="1" oninput="onSlider(this,'gap-val','px');updatePreview()">
      </div>
      <div class="field">
        <label><span data-i18n="field_sheet_pad"></span><span class="val" id="sheet-pad-val">0 px</span></label>
        <input type="range" id="sheet-pad" min="0" max="50" value="0" step="2" oninput="onSlider(this,'sheet-pad-val','px')">
      </div>

      <div class="divider" style="margin-bottom:0.7rem"></div>

      <div class="toggle-row">
        <span class="toggle-label" data-i18n="toggle_radius"></span>
        <button class="toggle" id="radius-toggle" onclick="toggleRadius()"></button>
      </div>
      <div class="field" id="radius-field" style="display:none">
        <label><span data-i18n="field_radius"></span><span class="val" id="radius-val">10 px</span></label>
        <input type="range" id="border-radius" min="2" max="50" value="10" step="1" oninput="onSlider(this,'radius-val','px');updatePreview()">
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="btn-row">
    <button class="btn btn-generate" onclick="generate()" data-i18n="btn_generate"></button>
    <button class="btn btn-print" onclick="doPrint()" data-i18n="btn_print"></button>
    <button class="btn btn-clear" onclick="clearAll()" data-i18n="btn_clear"></button>
  </div>

</div><!-- end sidebar -->

<div class="main" id="main">
  <div class="empty-state" id="empty-state">
    <div class="big">âœ‚ï¸</div>
    <h2 data-i18n="empty_h"></h2>
    <p data-i18n-html="empty_p"></p>
  </div>
  <div class="sheets-wrapper" id="sheets-wrapper" style="display:none"></div>
</div>
</div><!-- end .app -->

<!-- MOBILE ACTION BAR (visible only on mobile) -->
<div class="mobile-actions" id="mobile-actions">
  <button class="btn btn-generate" onclick="generate();closeSidebar()" data-i18n="btn_generate"></button>
  <button class="btn btn-print" onclick="doPrint()" data-i18n="btn_print"></button>
</div>

<div class="toast" id="toast"></div>

<!-- WARNING MODAL -->
<div class="warn-overlay" id="warn-overlay">
  <div class="warn-box">
    <div class="warn-icon">âš ï¸</div>
    <h3 data-i18n="warn_title"></h3>
    <p id="warn-body-text"></p>
    <div class="warn-actions">
      <button class="btn btn-warn-cancel" onclick="closeWarn()" data-i18n="warn_cancel"></button>
      <button class="btn btn-warn-proceed" onclick="confirmGenerate()" data-i18n="warn_proceed"></button>
    </div>
  </div>
</div>

<!-- PDF OVERLAY -->
<div class="pdf-overlay" id="pdf-overlay">
  <div class="pdf-overlay-box">
    <div class="pdf-icon">ğŸ“„</div>
    <h3 data-i18n="pdf_title"></h3>
    <div class="pdf-sub" id="pdf-sub"></div>
    <div class="pdf-progress-track">
      <div class="pdf-progress-fill" id="pdf-progress-fill"></div>
    </div>
    <div class="pdf-progress-label" id="pdf-progress-label">0 %</div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRANSLATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LANGS = {
  cs: {
    header_sub:       'max. 64 pÃ¡rÅ¯ Â· 128 karet Â· tisk A4',
    sec1_title:       'ObrÃ¡zky',
    dropzone_text:    'PÅ™etÃ¡hnÄ›te nebo <strong>kliknÄ›te</strong><br>max. 64 obrÃ¡zkÅ¯ = 128 karet',
    counter_imgs:     'obr.',
    counter_cards:    'karet',
    sec2_title:       'RubovÃ¡ strana',
    tab_preset:       'Vzor',
    tab_custom:       'VlastnÃ­ obrÃ¡zek',
    back_upload_hint: 'Nahrajte obrÃ¡zek rubovÃ© strany',
    back_remove:      'âœ• Odebrat',
    sec3_title:       'RozloÅ¾enÃ­',
    field_title:      'NÃ¡zev hry',
    default_title:    'Moje Pexeso',
    field_cols:       'PoÄet sloupcÅ¯',
    col_3: '3 sloupce', col_4: '4 sloupce', col_5: '5 sloupcÅ¯', col_6: '6 sloupcÅ¯',
    field_size:       'Velikost karet',
    field_pdf_orient: 'Orientace PDF',
    orient_portrait:  'Na vÃ½Å¡ku',
    orient_landscape: 'Na Å¡Ã­Å™ku',
    sec4_title:       'Styl karet',
    preview_label:    'NÃ¡hled karty',
    field_border_style: 'Styl okraje',
    bs_none: 'Å½Ã¡dnÃ½', bs_solid: 'PlnÃ½', bs_dashed: 'ÄŒÃ¡rk.', bs_hatched: 'Å raf.',
    field_border_w:   'TlouÅ¡Å¥ka okraje',
    field_border_color: 'Barva okraje',
    field_inner_pad:  'VnitÅ™nÃ­ odsazenÃ­',
    field_outer_mar:  'VnÄ›jÅ¡Ã­ odsazenÃ­',
    field_gap:        'Mezera mezi kartami',
    field_sheet_pad:  'OdsazenÃ­ listu od okraje',
    toggle_radius:    'ZaoblenÃ­ rohÅ¯',
    field_radius:     'PolomÄ›r zaoblenÃ­',
    btn_generate:     'âœ‚ Vygenerovat pexeso',
    btn_pdf:          'â¬‡ UloÅ¾it jako PDF',
    btn_print:        'ğŸ–¨ Vytisknout',
    btn_clear:        'ğŸ—‘ Vymazat vÅ¡e',
    empty_h:          'PÅ™ipraveno ke stÅ™ihÃ¡nÃ­!',
    empty_p:          'Nahrajte obrÃ¡zky vlevo a kliknÄ›te na <strong>Vygenerovat pexeso</strong>',
    warn_title:       'HodnÄ› karet!',
    warn_body:        'Generujete vÃ­ce neÅ¾ <strong>32 pÃ¡rÅ¯ ({pairs} pÃ¡rÅ¯, {cards} karet)</strong>.<br><br>Tisk mÅ¯Å¾e trvat dÃ©le a vÃ½slednÃ© PDF bude velkÃ½ soubor.',
    warn_cancel:      'ZruÅ¡it',
    warn_proceed:     'âš¡ PokraÄovat',
    pdf_title:        'Generuji PDFâ€¦',
    pdf_init:         'Inicializujiâ€¦',
    pdf_preparing:    'PÅ™ipravuji listyâ€¦',
    pdf_processing:   'ZpracovÃ¡vÃ¡m list {i} / {total}â€¦',
    pdf_saving:       'UklÃ¡dÃ¡m souborâ€¦',
    pdf_done:         'Hotovo! âœ“',
    sheet_front:      'PÅ˜EDNÃ STRANA',
    sheet_back:       'RUBOVÃ STRANA',
    sheet_list1:      'List 1',
    sheet_list2:      'List 2',
    sheet_info_front: '{n} karet Â· {r} Ã— {c}',
    sheet_info_back:  '{n} karet Â· zrcadleno',
    note_front:       '<strong>ğŸ’¡ Tip:</strong> TisknÄ›te na pevnÄ›jÅ¡Ã­ papÃ­r (120â€“200 g/mÂ²). StÅ™Ã­hejte podÃ©l pÅ™eruÅ¡ovanÃ½ch Äar. Toto je <strong>strana 1</strong> (pÅ™ednÃ­).',
    note_back:        '<strong>ğŸ–¨ï¸ OboustrannÃ½ tisk:</strong> VloÅ¾te list 1 zpÄ›t do tiskÃ¡rny a tisknÄ›te tuto stranu. RubovÃ¡ strana je <strong>zrcadlena</strong> pro pÅ™esnÃ© pÅ™ekrytÃ­.<br><strong>JednostrannÃ½ tisk:</strong> VystÅ™ihnÄ›te a slepte karty k sobÄ›.',
    pdf_label_front:  'Strana {n} â€” PÅ˜EDNÃ',
    pdf_label_back:   'Strana {n} â€” RUBOVÃ',
    toast_no_images:  'Nejprve nahrajte obrÃ¡zky! ğŸ–¼ï¸',
    toast_no_back:    'Nahrajte rubovÃ½ obrÃ¡zek nebo zvolte vzor',
    toast_max:        'Max 64 obrÃ¡zkÅ¯!',
    toast_added:      'PÅ™idÃ¡no {n} obrÃ¡zkÅ¯ âœ“',
    toast_generated:  'Pexeso vygenerovÃ¡no! {n} pÃ¡rÅ¯ âœ‚ï¸',
    toast_cleared:    'VymazÃ¡no ğŸ—‘',
    toast_print_first:'Nejprve vygenerujte pexeso!',
    toast_pdf_saved:  'PDF uloÅ¾eno! ğŸ‰',
    toast_pdf_error:  'Chyba pÅ™i generovÃ¡nÃ­ PDF.',
    toast_back_ok:    'RubovÃ½ obrÃ¡zek nahrÃ¡n âœ“',
    pat_rainbow: 'DuhovÃ½', pat_blue: 'ModrÃ½', pat_red: 'ÄŒervenÃ½', pat_green: 'ZelenÃ½',
    pat_stars: 'HvÄ›zdy', pat_dots: 'TeÄky', pat_stripes: 'Pruhy', pat_dark: 'TmavÃ½', pat_pink: 'RÅ¯Å¾ovÃ½',
  },
  en: {
    header_sub:       'max. 64 pairs Â· 128 cards Â· A4 print',
    sec1_title:       'Images',
    dropzone_text:    'Drag & drop or <strong>click to browse</strong><br>max. 64 images = 128 cards',
    counter_imgs:     'imgs.',
    counter_cards:    'cards',
    sec2_title:       'Card back',
    tab_preset:       'Pattern',
    tab_custom:       'Custom image',
    back_upload_hint: 'Upload a back-side image',
    back_remove:      'âœ• Remove',
    sec3_title:       'Layout',
    field_title:      'Game title',
    default_title:    'My Memory Game',
    field_cols:       'Columns',
    col_3: '3 columns', col_4: '4 columns', col_5: '5 columns', col_6: '6 columns',
    field_size:       'Card size',
    field_pdf_orient: 'PDF orientation',
    orient_portrait:  'Portrait',
    orient_landscape: 'Landscape',
    sec4_title:       'Card style',
    preview_label:    'Card preview',
    field_border_style: 'Border style',
    bs_none: 'None', bs_solid: 'Solid', bs_dashed: 'Dashed', bs_hatched: 'Hatched',
    field_border_w:   'Border width',
    field_border_color: 'Border color',
    field_inner_pad:  'Inner padding',
    field_outer_mar:  'Outer margin',
    field_gap:        'Gap between cards',
    field_sheet_pad:  'Sheet margin',
    toggle_radius:    'Rounded corners',
    field_radius:     'Corner radius',
    btn_generate:     'âœ‚ Generate cards',
    btn_pdf:          'â¬‡ Save as PDF',
    btn_print:        'ğŸ–¨ Print',
    btn_clear:        'ğŸ—‘ Clear all',
    empty_h:          'Ready to cut!',
    empty_p:          'Upload images on the left and click <strong>Generate cards</strong>',
    warn_title:       'Lots of cards!',
    warn_body:        'You are generating more than <strong>32 pairs ({pairs} pairs, {cards} cards)</strong>.<br><br>Printing may take longer and the PDF will be large.',
    warn_cancel:      'Cancel',
    warn_proceed:     'âš¡ Continue',
    pdf_title:        'Generating PDFâ€¦',
    pdf_init:         'Initialisingâ€¦',
    pdf_preparing:    'Preparing sheetsâ€¦',
    pdf_processing:   'Processing sheet {i} / {total}â€¦',
    pdf_saving:       'Saving fileâ€¦',
    pdf_done:         'Done! âœ“',
    sheet_front:      'FRONT SIDE',
    sheet_back:       'BACK SIDE',
    sheet_list1:      'Sheet 1',
    sheet_list2:      'Sheet 2',
    sheet_info_front: '{n} cards Â· {r} Ã— {c}',
    sheet_info_back:  '{n} cards Â· mirrored',
    note_front:       '<strong>ğŸ’¡ Tip:</strong> Print on heavier paper (120â€“200 g/mÂ²). Cut along the dashed lines. This is <strong>sheet 1</strong> (front).',
    note_back:        '<strong>ğŸ–¨ï¸ Duplex printing:</strong> Reload sheet 1 into the printer and print this side. The back is <strong>mirrored</strong> for perfect alignment.<br><strong>Single-sided:</strong> Cut out and glue front and back together.',
    pdf_label_front:  'Sheet {n} â€” FRONT',
    pdf_label_back:   'Sheet {n} â€” BACK',
    toast_no_images:  'Please upload images first! ğŸ–¼ï¸',
    toast_no_back:    'Upload a back image or choose a pattern',
    toast_max:        'Max 64 images!',
    toast_added:      '{n} images added âœ“',
    toast_generated:  'Cards generated! {n} pairs âœ‚ï¸',
    toast_cleared:    'Cleared ğŸ—‘',
    toast_print_first:'Generate cards first!',
    toast_pdf_saved:  'PDF saved! ğŸ‰',
    toast_pdf_error:  'Error generating PDF.',
    toast_back_ok:    'Back image uploaded âœ“',
    pat_rainbow: 'Rainbow', pat_blue: 'Blue', pat_red: 'Red', pat_green: 'Green',
    pat_stars: 'Stars', pat_dots: 'Dots', pat_stripes: 'Stripes', pat_dark: 'Dark', pat_pink: 'Pink',
  },
  sk: {
    header_sub:       'max. 64 pÃ¡rov Â· 128 kariet Â· tlaÄ A4',
    sec1_title:       'ObrÃ¡zky',
    dropzone_text:    'Potiahnite alebo <strong>kliknite</strong><br>max. 64 obrÃ¡zkov = 128 kariet',
    counter_imgs:     'obr.',
    counter_cards:    'kariet',
    sec2_title:       'Rub karty',
    tab_preset:       'Vzor',
    tab_custom:       'VlastnÃ½ obrÃ¡zok',
    back_upload_hint: 'Nahrajte obrÃ¡zok rubu karty',
    back_remove:      'âœ• OdstrÃ¡niÅ¥',
    sec3_title:       'RozloÅ¾enie',
    field_title:      'NÃ¡zov hry',
    default_title:    'Moje Pexeso',
    field_cols:       'PoÄet stÄºpcov',
    col_3: '3 stÄºpce', col_4: '4 stÄºpce', col_5: '5 stÄºpcov', col_6: '6 stÄºpcov',
    field_size:       'VeÄ¾kosÅ¥ kariet',
    field_pdf_orient: 'OrientÃ¡cia PDF',
    orient_portrait:  'Na vÃ½Å¡ku',
    orient_landscape: 'Na Å¡Ã­rku',
    sec4_title:       'Å tÃ½l kariet',
    preview_label:    'NÃ¡hÄ¾ad karty',
    field_border_style: 'Å tÃ½l okraja',
    bs_none: 'Å½iadny', bs_solid: 'PlnÃ½', bs_dashed: 'ÄŒiarkov.', bs_hatched: 'Å rafov.',
    field_border_w:   'HrÃºbka okraja',
    field_border_color: 'Farba okraja',
    field_inner_pad:  'VnÃºtornÃ© odsadenie',
    field_outer_mar:  'VonkajÅ¡ie odsadenie',
    field_gap:        'Medzera medzi kartami',
    field_sheet_pad:  'Odsadenie listu od okraja',
    toggle_radius:    'Zaoblenie rohov',
    field_radius:     'Polomer zaoblenia',
    btn_generate:     'âœ‚ VygenerovaÅ¥ pexeso',
    btn_pdf:          'â¬‡ UloÅ¾iÅ¥ ako PDF',
    btn_print:        'ğŸ–¨ TlaÄiÅ¥',
    btn_clear:        'ğŸ—‘ VymazaÅ¥ vÅ¡etko',
    empty_h:          'PripravenÃ© na strihanie!',
    empty_p:          'Nahrajte obrÃ¡zky vÄ¾avo a kliknite na <strong>VygenerovaÅ¥ pexeso</strong>',
    warn_title:       'VeÄ¾a kariet!',
    warn_body:        'Generujete viac ako <strong>32 pÃ¡rov ({pairs} pÃ¡rov, {cards} kariet)</strong>.<br><br>TlaÄ mÃ´Å¾e trvaÅ¥ dlhÅ¡ie a PDF bude veÄ¾kÃ½ sÃºbor.',
    warn_cancel:      'ZruÅ¡iÅ¥',
    warn_proceed:     'âš¡ PokraÄovaÅ¥',
    pdf_title:        'Generujem PDFâ€¦',
    pdf_init:         'Inicializujemâ€¦',
    pdf_preparing:    'Pripravujem listyâ€¦',
    pdf_processing:   'SpracovÃ¡vam list {i} / {total}â€¦',
    pdf_saving:       'UkladÃ¡m sÃºborâ€¦',
    pdf_done:         'Hotovo! âœ“',
    sheet_front:      'PREDNÃ STRANA',
    sheet_back:       'RUBOVÃ STRANA',
    sheet_list1:      'List 1',
    sheet_list2:      'List 2',
    sheet_info_front: '{n} kariet Â· {r} Ã— {c}',
    sheet_info_back:  '{n} kariet Â· zrkadlenÃ©',
    note_front:       '<strong>ğŸ’¡ Tip:</strong> TlaÄte na pevnejÅ¡Ã­ papier (120â€“200 g/mÂ²). Strihajte pozdÄºÅ¾ preruÅ¡ovanÃ½ch Äiar. Toto je <strong>strana 1</strong> (prednÃ¡).',
    note_back:        '<strong>ğŸ–¨ï¸ ObojstrannÃ¡ tlaÄ:</strong> VloÅ¾te list 1 spÃ¤Å¥ do tlaÄiarne a tlaÄte tÃºto stranu. Rub je <strong>zrkadlenÃ½</strong> pre presnÃ© prekrytie.<br><strong>JednostrannÃ¡ tlaÄ:</strong> Vystrihnite a zlepte karty.',
    pdf_label_front:  'Strana {n} â€” PREDNÃ',
    pdf_label_back:   'Strana {n} â€” RUBOVÃ',
    toast_no_images:  'Najprv nahrajte obrÃ¡zky! ğŸ–¼ï¸',
    toast_no_back:    'Nahrajte obrÃ¡zok rubu alebo zvoÄ¾te vzor',
    toast_max:        'Max 64 obrÃ¡zkov!',
    toast_added:      'PridanÃ½ch {n} obrÃ¡zkov âœ“',
    toast_generated:  'Pexeso vygenerovanÃ©! {n} pÃ¡rov âœ‚ï¸',
    toast_cleared:    'VymazanÃ© ğŸ—‘',
    toast_print_first:'Najprv vygenerujte pexeso!',
    toast_pdf_saved:  'PDF uloÅ¾enÃ©! ğŸ‰',
    toast_pdf_error:  'Chyba pri generovanÃ­ PDF.',
    toast_back_ok:    'ObrÃ¡zok rubu nahranÃ½ âœ“',
    pat_rainbow: 'DÃºhovÃ½', pat_blue: 'ModrÃ½', pat_red: 'ÄŒervenÃ½', pat_green: 'ZelenÃ½',
    pat_stars: 'Hviezdy', pat_dots: 'Bodky', pat_stripes: 'Pruhy', pat_dark: 'TmavÃ½', pat_pink: 'RuÅ¾ovÃ½',
  },
  pl: {
    header_sub:       'maks. 64 pary Â· 128 kart Â· druk A4',
    sec1_title:       'Obrazki',
    dropzone_text:    'PrzeciÄ…gnij lub <strong>kliknij</strong><br>maks. 64 obrazki = 128 kart',
    counter_imgs:     'obr.',
    counter_cards:    'kart',
    sec2_title:       'Rewers karty',
    tab_preset:       'WzÃ³r',
    tab_custom:       'WÅ‚asny obraz',
    back_upload_hint: 'PrzeÅ›lij obraz rewersu karty',
    back_remove:      'âœ• UsuÅ„',
    sec3_title:       'UkÅ‚ad',
    field_title:      'Nazwa gry',
    default_title:    'Moje Memory',
    field_cols:       'Liczba kolumn',
    col_3: '3 kolumny', col_4: '4 kolumny', col_5: '5 kolumn', col_6: '6 kolumn',
    field_size:       'Rozmiar kart',
    field_pdf_orient: 'Orientacja PDF',
    orient_portrait:  'Pionowo',
    orient_landscape: 'Poziomo',
    sec4_title:       'Styl kart',
    preview_label:    'PodglÄ…d karty',
    field_border_style: 'Styl obramowania',
    bs_none: 'Brak', bs_solid: 'PeÅ‚ne', bs_dashed: 'Przeryw.', bs_hatched: 'Kreskov.',
    field_border_w:   'GruboÅ›Ä‡ ramki',
    field_border_color: 'Kolor ramki',
    field_inner_pad:  'WewnÄ™trzny margines',
    field_outer_mar:  'ZewnÄ™trzny margines',
    field_gap:        'OdstÄ™p miÄ™dzy kartami',
    field_sheet_pad:  'Margines arkusza',
    toggle_radius:    'ZaokrÄ…glone rogi',
    field_radius:     'PromieÅ„ zaokrÄ…glenia',
    btn_generate:     'âœ‚ Wygeneruj karty',
    btn_pdf:          'â¬‡ Zapisz jako PDF',
    btn_print:        'ğŸ–¨ Drukuj',
    btn_clear:        'ğŸ—‘ WyczyÅ›Ä‡ wszystko',
    empty_h:          'Gotowe do ciÄ™cia!',
    empty_p:          'PrzeÅ›lij obrazki po lewej i kliknij <strong>Wygeneruj karty</strong>',
    warn_title:       'DuÅ¼o kart!',
    warn_body:        'Generujesz wiÄ™cej niÅ¼ <strong>32 pary ({pairs} par, {cards} kart)</strong>.<br><br>Drukowanie moÅ¼e potrwaÄ‡ dÅ‚uÅ¼ej, a PDF bÄ™dzie duÅ¼y.',
    warn_cancel:      'Anuluj',
    warn_proceed:     'âš¡ Kontynuuj',
    pdf_title:        'GenerujÄ™ PDFâ€¦',
    pdf_init:         'InicjalizujÄ™â€¦',
    pdf_preparing:    'PrzygotowujÄ™ arkuszeâ€¦',
    pdf_processing:   'Przetwarzam arkusz {i} / {total}â€¦',
    pdf_saving:       'ZapisujÄ™ plikâ€¦',
    pdf_done:         'Gotowe! âœ“',
    sheet_front:      'AWERS',
    sheet_back:       'REWERS',
    sheet_list1:      'Arkusz 1',
    sheet_list2:      'Arkusz 2',
    sheet_info_front: '{n} kart Â· {r} Ã— {c}',
    sheet_info_back:  '{n} kart Â· lustrzane',
    note_front:       '<strong>ğŸ’¡ WskazÃ³wka:</strong> Drukuj na grubszym papierze (120â€“200 g/mÂ²). Wycinaj wzdÅ‚uÅ¼ przerywanych linii. To jest <strong>arkusz 1</strong> (awers).',
    note_back:        '<strong>ğŸ–¨ï¸ Druk dwustronny:</strong> WÅ‚Ã³Å¼ arkusz 1 z powrotem do drukarki i drukuj tÄ™ stronÄ™. Rewers jest <strong>lustrzany</strong> dla idealnego dopasowania.<br><strong>Druk jednostronny:</strong> Wytnij i sklej karty.',
    pdf_label_front:  'Strona {n} â€” AWERS',
    pdf_label_back:   'Strona {n} â€” REWERS',
    toast_no_images:  'Najpierw przeÅ›lij obrazki! ğŸ–¼ï¸',
    toast_no_back:    'PrzeÅ›lij obraz rewersu lub wybierz wzÃ³r',
    toast_max:        'Maks. 64 obrazki!',
    toast_added:      'Dodano {n} obrazkÃ³w âœ“',
    toast_generated:  'Karty wygenerowane! {n} par âœ‚ï¸',
    toast_cleared:    'Wyczyszczono ğŸ—‘',
    toast_print_first:'Najpierw wygeneruj karty!',
    toast_pdf_saved:  'PDF zapisany! ğŸ‰',
    toast_pdf_error:  'BÅ‚Ä…d generowania PDF.',
    toast_back_ok:    'Obraz rewersu przesÅ‚any âœ“',
    pat_rainbow: 'TÄ™czowy', pat_blue: 'Niebieski', pat_red: 'Czerwony', pat_green: 'Zielony',
    pat_stars: 'Gwiazdy', pat_dots: 'Kropki', pat_stripes: 'Paski', pat_dark: 'Ciemny', pat_pink: 'RÃ³Å¼owy',
  },
  de: {
    header_sub:       'max. 64 Paare Â· 128 Karten Â· A4-Druck',
    sec1_title:       'Bilder',
    dropzone_text:    'Ziehen oder <strong>klicken</strong><br>max. 64 Bilder = 128 Karten',
    counter_imgs:     'Bilder',
    counter_cards:    'Karten',
    sec2_title:       'KartenrÃ¼ckseite',
    tab_preset:       'Muster',
    tab_custom:       'Eigenes Bild',
    back_upload_hint: 'Bild fÃ¼r die RÃ¼ckseite hochladen',
    back_remove:      'âœ• Entfernen',
    sec3_title:       'Layout',
    field_title:      'Spielname',
    default_title:    'Mein Memory',
    field_cols:       'Spaltenanzahl',
    col_3: '3 Spalten', col_4: '4 Spalten', col_5: '5 Spalten', col_6: '6 Spalten',
    field_size:       'KartengrÃ¶ÃŸe',
    field_pdf_orient: 'PDF-Ausrichtung',
    orient_portrait:  'Hochformat',
    orient_landscape: 'Querformat',
    sec4_title:       'Kartenstil',
    preview_label:    'Kartenvorschau',
    field_border_style: 'Rahmenstil',
    bs_none: 'Keiner', bs_solid: 'Voll', bs_dashed: 'Gestrich.', bs_hatched: 'Schraffiert',
    field_border_w:   'Rahmenbreite',
    field_border_color: 'Rahmenfarbe',
    field_inner_pad:  'Innenabstand',
    field_outer_mar:  'AuÃŸenabstand',
    field_gap:        'Abstand zwischen Karten',
    field_sheet_pad:  'Blattrand',
    toggle_radius:    'Abgerundete Ecken',
    field_radius:     'Eckenradius',
    btn_generate:     'âœ‚ Karten generieren',
    btn_pdf:          'â¬‡ Als PDF speichern',
    btn_print:        'ğŸ–¨ Drucken',
    btn_clear:        'ğŸ—‘ Alles lÃ¶schen',
    empty_h:          'Bereit zum Schneiden!',
    empty_p:          'Bilder links hochladen und auf <strong>Karten generieren</strong> klicken',
    warn_title:       'Viele Karten!',
    warn_body:        'Sie generieren mehr als <strong>32 Paare ({pairs} Paare, {cards} Karten)</strong>.<br><br>Das Drucken kann lÃ¤nger dauern und das PDF wird groÃŸ.',
    warn_cancel:      'Abbrechen',
    warn_proceed:     'âš¡ Weiter',
    pdf_title:        'PDF wird erstelltâ€¦',
    pdf_init:         'Initialisierungâ€¦',
    pdf_preparing:    'BlÃ¤tter werden vorbereitetâ€¦',
    pdf_processing:   'Blatt {i} / {total} wird verarbeitetâ€¦',
    pdf_saving:       'Datei wird gespeichertâ€¦',
    pdf_done:         'Fertig! âœ“',
    sheet_front:      'VORDERSEITE',
    sheet_back:       'RÃœCKSEITE',
    sheet_list1:      'Blatt 1',
    sheet_list2:      'Blatt 2',
    sheet_info_front: '{n} Karten Â· {r} Ã— {c}',
    sheet_info_back:  '{n} Karten Â· gespiegelt',
    note_front:       '<strong>ğŸ’¡ Tipp:</strong> Drucken Sie auf stÃ¤rkerem Papier (120â€“200 g/mÂ²). Schneiden Sie entlang der gestrichelten Linien. Dies ist <strong>Blatt 1</strong> (Vorderseite).',
    note_back:        '<strong>ğŸ–¨ï¸ Duplexdruck:</strong> Legen Sie Blatt 1 wieder in den Drucker und drucken Sie diese Seite. Die RÃ¼ckseite ist <strong>gespiegelt</strong> fÃ¼r genaue Ãœbereinstimmung.<br><strong>Einseitiger Druck:</strong> Ausschneiden und zusammenkleben.',
    pdf_label_front:  'Seite {n} â€” VORDER',
    pdf_label_back:   'Seite {n} â€” RÃœCK',
    toast_no_images:  'Bitte zuerst Bilder hochladen! ğŸ–¼ï¸',
    toast_no_back:    'RÃ¼ckseitenbild hochladen oder Muster wÃ¤hlen',
    toast_max:        'Max. 64 Bilder!',
    toast_added:      '{n} Bilder hinzugefÃ¼gt âœ“',
    toast_generated:  'Karten generiert! {n} Paare âœ‚ï¸',
    toast_cleared:    'Geleert ğŸ—‘',
    toast_print_first:'Bitte zuerst Karten generieren!',
    toast_pdf_saved:  'PDF gespeichert! ğŸ‰',
    toast_pdf_error:  'Fehler beim Erstellen des PDFs.',
    toast_back_ok:    'RÃ¼ckseitenbild hochgeladen âœ“',
    pat_rainbow: 'Regenbogen', pat_blue: 'Blau', pat_red: 'Rot', pat_green: 'GrÃ¼n',
    pat_stars: 'Sterne', pat_dots: 'Punkte', pat_stripes: 'Streifen', pat_dark: 'Dunkel', pat_pink: 'Rosa',
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIDEBAR TOGGLE (mobile)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleSidebar() {
  const s = document.getElementById('sidebar');
  const o = document.getElementById('sidebar-overlay');
  const open = s.classList.toggle('open');
  o.classList.toggle('visible', open);
  document.body.style.overflow = open ? 'hidden' : '';
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebar-overlay').classList.remove('visible');
  document.body.style.overflow = '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// I18N ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentLang = 'cs';

function t(key, vars = {}) {
  let str = (LANGS[currentLang] || LANGS.cs)[key] || key;
  Object.entries(vars).forEach(([k,v]) => { str = str.replaceAll(`{${k}}`, v); });
  return str;
}

function setLang(code) {
  currentLang = code;
  document.getElementById('html-root').lang = code;
  document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.dataset.lang === code));
  applyLang();
  // Re-render swatches (names translate)
  initSwatches();
  // Re-render column options
  document.querySelectorAll('#cols-select option[data-i18n]').forEach(o => {
    o.textContent = t(o.dataset.i18n);
  });
  // Update game-title placeholder
  document.getElementById('game-title').placeholder = t('default_title');
  // If game title is still default in any language, update it too
  localStorage.setItem('pexeso-lang', code);
}

function applyLang() {
  // data-i18n â†’ textContent
  document.querySelectorAll('[data-i18n]').forEach(el => {
    el.textContent = t(el.dataset.i18n);
  });
  // data-i18n-html â†’ innerHTML
  document.querySelectorAll('[data-i18n-html]').forEach(el => {
    el.innerHTML = t(el.dataset.i18nHtml || el.getAttribute('data-i18n-html'));
  });
  // data-i18n-placeholder â†’ placeholder
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    el.placeholder = t(el.getAttribute('data-i18n-placeholder'));
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let images = [];
let backMode = 'preset';
let selectedPattern = 0;
let customBackSrc = null;
let borderStyleVal = 'none';
let radiusEnabled = false;
let pdfOrient = 'portrait'; // 'portrait' | 'landscape'

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PATTERNS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const patternDefs = [
  { key: 'pat_rainbow', bg: 'linear-gradient(135deg,#f97316,#facc15,#4ade80,#38bdf8,#a78bfa)' },
  { key: 'pat_blue',    bg: 'repeating-linear-gradient(45deg,#1d4ed8 0,#1d4ed8 8px,#2563eb 8px,#2563eb 16px)' },
  { key: 'pat_red',     bg: 'linear-gradient(135deg,#b91c1c,#ef4444)' },
  { key: 'pat_green',   bg: 'linear-gradient(135deg,#065f46,#34d399)' },
  { key: 'pat_stars',   bg: '#1e1b4b', extra: 'radial-gradient(circle,rgba(255,255,255,.7) 1px,transparent 1px) 0 0/18px 18px' },
  { key: 'pat_dots',    bg: '#fff',    extra: 'radial-gradient(circle,#f97316 2px,transparent 2px) 0 0/20px 20px,radial-gradient(circle,#fbbf24 2px,transparent 2px) 10px 10px/20px 20px' },
  { key: 'pat_stripes', bg: 'repeating-linear-gradient(0deg,#fef9c3 0,#fef9c3 10px,#fde047 10px,#fde047 20px)' },
  { key: 'pat_dark',    bg: '#18181b' },
  { key: 'pat_pink',    bg: 'linear-gradient(135deg,#be185d,#ec4899,#f9a8d4)' },
];

function initSwatches() {
  const grid = document.getElementById('swatch-grid');
  grid.innerHTML = '';
  patternDefs.forEach((p,i) => {
    const name = t(p.key);
    const el = document.createElement('div');
    el.className = 'swatch' + (i===selectedPattern?' active':'');
    el.title = name;
    let s = `background:${p.bg};width:100%;`;
    if(p.extra) s += `background-image:${p.extra};`;
    el.setAttribute('style', s);
    el.innerHTML = `<div class="swatch-label">${name}</div>`;
    el.onclick = () => { selectedPattern = i; initSwatches(); };
    grid.appendChild(el);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACCORDION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleAcc(id) { document.getElementById(id).classList.toggle('open'); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(mode) {
  backMode = mode;
  document.querySelectorAll('.tab-btn').forEach((b,i) =>
    b.classList.toggle('active', (i===0&&mode==='preset')||(i===1&&mode==='custom')));
  document.getElementById('tab-preset').classList.toggle('active', mode==='preset');
  document.getElementById('tab-custom').classList.toggle('active', mode==='custom');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SLIDERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onSlider(el, valId, suffix) {
  document.getElementById(valId).textContent = el.value + ' ' + suffix;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BORDER STYLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setBorderStyle(btn) {
  document.querySelectorAll('#border-style-group .icon-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  borderStyleVal = btn.dataset.val;
  const show = borderStyleVal !== 'none';
  document.getElementById('border-thickness-field').style.display = show ? '' : 'none';
  document.getElementById('border-color-field').style.display = show ? '' : 'none';
  updatePreview();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PDF ORIENTATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setOrient(btn) {
  document.querySelectorAll('#orient-group .icon-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  pdfOrient = btn.dataset.val;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RADIUS TOGGLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleRadius() {
  radiusEnabled = !radiusEnabled;
  document.getElementById('radius-toggle').classList.toggle('on', radiusEnabled);
  document.getElementById('radius-field').style.display = radiusEnabled ? '' : 'none';
  updatePreview();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LIVE PREVIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updatePreview() {
  const bw = borderStyleVal === 'none' ? 0 : parseInt(document.getElementById('border-w').value);
  const bc = document.getElementById('border-color').value;
  const ip = parseInt(document.getElementById('inner-pad').value);
  const om = parseInt(document.getElementById('outer-mar').value);
  const r  = radiusEnabled ? parseInt(document.getElementById('border-radius').value) : 0;
  const mini = document.getElementById('card-mini');
  const inner = document.getElementById('card-mini-inner');
  const scale = 90;
  const cardSize = parseInt(document.getElementById('size-select').value);
  const f = scale / cardSize;
  const omS = om * f, bwS = bw * f, ipS = ip * f, rS = r * f;

  mini.style.cssText = 'position:absolute;inset:0;background:white;';
  if (borderStyleVal === 'hatched') {
    mini.style.position = 'absolute';
    mini.style.inset = omS + 'px';
    mini.style.borderRadius = rS + 'px';
    mini.style.background = `repeating-linear-gradient(45deg,transparent 0,transparent 3px,${bc} 3px,${bc} 4px),repeating-linear-gradient(-45deg,transparent 0,transparent 3px,${bc} 3px,${bc} 4px)`;
    inner.style.cssText = `position:absolute;top:${bwS}px;left:${bwS}px;right:${bwS}px;bottom:${bwS}px;border-radius:${Math.max(0,rS-bwS)}px;background:linear-gradient(135deg,#ddd,#eee);display:flex;align-items:center;justify-content:center;font-size:1.2rem;padding:${ipS}px;`;
  } else {
    const bCSS = borderStyleVal === 'none' ? 'none' : `${bwS}px ${borderStyleVal} ${bc}`;
    mini.style.position = 'absolute';
    mini.style.inset = omS + 'px';
    mini.style.borderRadius = rS + 'px';
    mini.style.border = bCSS;
    mini.style.background = 'transparent';
    inner.style.cssText = `position:absolute;inset:${ipS}px;border-radius:${Math.max(0,rS-bwS-ipS)}px;background:linear-gradient(135deg,#ddd,#eee);display:flex;align-items:center;justify-content:center;font-size:1.2rem;`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CARD PARAMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getCardParams() {
  return {
    cardPx:   parseInt(document.getElementById('size-select').value),
    cols:     parseInt(document.getElementById('cols-select').value),
    bStyle:   borderStyleVal,
    bWidth:   borderStyleVal === 'none' ? 0 : parseInt(document.getElementById('border-w').value),
    bColor:   document.getElementById('border-color').value,
    innerPad: parseInt(document.getElementById('inner-pad').value),
    outerMar: parseInt(document.getElementById('outer-mar').value),
    gap:      parseInt(document.getElementById('card-gap').value),
    sheetPad: parseInt(document.getElementById('sheet-pad').value),
    radius:   radiusEnabled ? parseInt(document.getElementById('border-radius').value) : 0,
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAKE CARD CELL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function makeCardCell(contentFn, p) {
  const cellSize = p.cardPx + p.gap;
  const cell = document.createElement('div');
  cell.className = 'grid-cell';
  cell.style.cssText = `width:${cellSize}px;height:${cellSize}px;`;
  const inset = p.outerMar + p.gap / 2;
  const bodySize = p.cardPx - p.outerMar * 2;
  const body = document.createElement('div');
  body.className = 'card-body';
  body.style.cssText = `top:${inset}px;left:${inset}px;width:${bodySize}px;height:${bodySize}px;border-radius:${p.radius}px;`;
  if (p.bStyle === 'hatched') {
    body.style.background = `repeating-linear-gradient(45deg,transparent 0,transparent 4px,${p.bColor} 4px,${p.bColor} 6px),repeating-linear-gradient(-45deg,transparent 0,transparent 4px,${p.bColor} 4px,${p.bColor} 6px)`;
    const cw = document.createElement('div');
    cw.style.cssText = `position:absolute;top:${p.bWidth}px;left:${p.bWidth}px;right:${p.bWidth}px;bottom:${p.bWidth}px;border-radius:${Math.max(0,p.radius-p.bWidth)}px;overflow:hidden;padding:${p.innerPad}px;background:white;`;
    contentFn(cw, p); body.appendChild(cw);
  } else {
    if (p.bStyle !== 'none') body.style.border = `${p.bWidth}px ${p.bStyle} ${p.bColor}`;
    body.style.padding = p.innerPad + 'px';
    body.style.overflow = 'hidden';
    contentFn(body, p);
  }
  cell.appendChild(body);
  return cell;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FRONT IMAGE UPLOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const frontDz = document.getElementById('front-dz');
const frontInput = document.getElementById('front-input');
frontDz.onclick = () => frontInput.click();
frontInput.onchange = e => handleFrontFiles(e.target.files);
frontDz.ondragover = e => { e.preventDefault(); frontDz.classList.add('over'); };
frontDz.ondragleave = () => frontDz.classList.remove('over');
frontDz.ondrop = e => { e.preventDefault(); frontDz.classList.remove('over'); handleFrontFiles(e.dataTransfer.files); };

function handleFrontFiles(files) {
  const valid = Array.from(files).filter(f => f.type.startsWith('image/'));
  if (!valid.length) return;
  const remaining = 64 - images.length;
  if (remaining <= 0) { toast(t('toast_max')); return; }
  const toLoad = valid.slice(0, remaining);
  let done = 0;
  toLoad.forEach(f => {
    const r = new FileReader();
    r.onload = e => {
      images.push({ id: Date.now()+Math.random(), src: e.target.result });
      if (++done === toLoad.length) { renderThumbs(); updateBadge(); toast(t('toast_added', {n: done})); }
    };
    r.readAsDataURL(f);
  });
}

function renderThumbs() {
  const grid = document.getElementById('thumb-grid');
  grid.innerHTML = '';
  images.forEach((img,idx) => {
    const d = document.createElement('div');
    d.className = 'thumb';
    d.innerHTML = `<img src="${img.src}"><button class="del" onclick="removeImg(${idx})">âœ•</button>`;
    grid.appendChild(d);
  });
  const bar = document.getElementById('counter-bar');
  if (images.length) {
    bar.style.display = 'block';
    document.getElementById('img-count').textContent = images.length;
    document.getElementById('card-count').textContent = images.length * 2 + ' (' + images.length + ')';
  } else { bar.style.display = 'none'; }
  frontInput.value = '';
}
function updateBadge() { document.getElementById('num-1').classList.toggle('done', images.length > 0); }
function removeImg(idx) { images.splice(idx,1); renderThumbs(); updateBadge(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BACK IMAGE UPLOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const backDzEl = document.getElementById('back-dz');
const backInput = document.getElementById('back-input');
backDzEl.onclick = e => { if(e.target!==backInput) backInput.click(); };
backInput.onchange = e => {
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader();
  r.onload = ev => {
    customBackSrc = ev.target.result;
    document.getElementById('back-preview').src = customBackSrc;
    document.getElementById('back-preview').style.display = 'block';
    document.getElementById('back-remove-btn').style.display = 'block';
    toast(t('toast_back_ok'));
  };
  r.readAsDataURL(f);
};
function removeBackImage() {
  customBackSrc = null;
  document.getElementById('back-preview').style.display = 'none';
  document.getElementById('back-remove-btn').style.display = 'none';
  backInput.value = '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GENERATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generate() {
  if (!images.length) { toast(t('toast_no_images')); return; }
  if (backMode === 'custom' && !customBackSrc) { toast(t('toast_no_back')); return; }
  if (images.length > 32) {
    document.getElementById('warn-body-text').innerHTML = t('warn_body', {pairs: images.length, cards: images.length*2});
    document.getElementById('warn-overlay').classList.add('visible');
    return;
  }
  doGenerate();
}

function confirmGenerate() { closeWarn(); doGenerate(); }
function closeWarn() { document.getElementById('warn-overlay').classList.remove('visible'); }

function doGenerate() {
  const p = getCardParams();
  const doubled = shuffle([...images, ...images]);
  document.getElementById('empty-state').style.display = 'none';
  const wrapper = document.getElementById('sheets-wrapper');
  wrapper.style.display = 'flex';
  wrapper.innerHTML = '';
  wrapper.appendChild(makeFrontSheet(doubled, p));
  wrapper.appendChild(makeBackSheet(doubled, p));
  toast(t('toast_generated', {n: images.length}));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FRONT SHEET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function makeFrontSheet(cards, p) {
  const block = document.createElement('div');
  block.className = 'sheet-block';
  const rows = Math.ceil(cards.length / p.cols);
  block.innerHTML = `
    <div class="sheet-header">
      <span class="sheet-badge">${t('sheet_front')}</span>
      <span class="sheet-info">${t('sheet_info_front',{n:cards.length,r:rows,c:p.cols})}</span>
      <span class="sheet-tip">${t('sheet_list1')}</span>
    </div>`;
  const body = document.createElement('div');
  body.className = 'sheet-body';
  body.style.padding = p.sheetPad + 'px';
  body.appendChild(buildGrid(cards, p, (card) => (container) => {
    const img = document.createElement('img');
    img.src = card.src; img.draggable = false;
    img.style.cssText = 'width:100%;height:100%;object-fit:cover;display:block;border-radius:inherit;';
    container.appendChild(img);
  }));
  const note = document.createElement('div');
  note.className = 'print-note';
  note.innerHTML = t('note_front');
  body.appendChild(note);
  block.appendChild(body);
  return block;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BACK SHEET
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function makeBackSheet(cards, p) {
  const block = document.createElement('div');
  block.className = 'sheet-block';
  const rows = Math.ceil(cards.length / p.cols);
  const mirrored = [];
  for (let r = 0; r < rows; r++) {
    const row = cards.slice(r * p.cols, r * p.cols + p.cols);
    mirrored.push(...[...row].reverse());
  }
  block.innerHTML = `
    <div class="sheet-header">
      <span class="sheet-badge back">${t('sheet_back')}</span>
      <span class="sheet-info">${t('sheet_info_back',{n:cards.length})}</span>
      <span class="sheet-tip back">${t('sheet_list2')}</span>
    </div>`;
  const body = document.createElement('div');
  body.className = 'sheet-body';
  body.style.padding = p.sheetPad + 'px';
  body.appendChild(buildGrid(mirrored, p, (_card) => (container) => {
    if (backMode === 'custom' && customBackSrc) {
      const img = document.createElement('img');
      img.src = customBackSrc; img.draggable = false;
      img.style.cssText = 'width:100%;height:100%;object-fit:cover;display:block;border-radius:inherit;';
      container.appendChild(img);
    } else {
      const pat = patternDefs[selectedPattern];
      container.style.background = pat.bg;
      if (pat.extra) container.style.backgroundImage = pat.extra;
      container.style.backgroundSize = 'cover';
    }
  }));
  const note = document.createElement('div');
  note.className = 'print-note';
  note.innerHTML = t('note_back');
  body.appendChild(note);
  block.appendChild(body);
  return block;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BUILD GRID  (rows rendered as separate divs â†’ no split on print)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildGrid(cards, p, contentFnFactory) {
  const cellSize = p.cardPx + p.gap;
  const rows = Math.ceil(cards.length / p.cols);

  const wrapper = document.createElement('div');
  wrapper.style.overflowX = 'auto';

  const outer = document.createElement('div');
  outer.className = 'cut-outer';

  // â”€â”€ left scissors column â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const scMarg = document.createElement('div');
  scMarg.className = 'scissors-margin';
  for (let r = 0; r < rows; r++) {
    const s = document.createElement('div');
    s.className = 'scissors-row';
    s.textContent = 'âœ‚';
    s.style.height = cellSize + 'px';
    scMarg.appendChild(s);
  }
  outer.appendChild(scMarg);

  // â”€â”€ right column: top scissors + rows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const colWrap = document.createElement('div');

  // top scissors
  const topSc = document.createElement('div');
  topSc.className = 'col-scissors';
  const colCount = Math.min(p.cols, cards.length);
  for (let c = 0; c < colCount; c++) {
    const s = document.createElement('div');
    s.className = 'col-scissors-cell';
    s.textContent = 'âœ‚';
    s.style.width = cellSize + 'px';
    topSc.appendChild(s);
  }
  colWrap.appendChild(topSc);

  // grid container (left + top border only)
  const gridWrap = document.createElement('div');
  gridWrap.className = 'cut-grid-wrap';

  for (let r = 0; r < rows; r++) {
    const rowEl = document.createElement('div');
    rowEl.className = 'cut-row';

    const rowCards = cards.slice(r * p.cols, r * p.cols + p.cols);
    rowCards.forEach(card => {
      rowEl.appendChild(makeCardCell(contentFnFactory(card), p));
    });

    gridWrap.appendChild(rowEl);
  }

  colWrap.appendChild(gridWrap);
  outer.appendChild(colWrap);
  wrapper.appendChild(outer);
  return wrapper;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length-1; i>0; i--) { const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
  return a;
}

function clearAll() {
  images = []; renderThumbs(); updateBadge();
  customBackSrc = null;
  document.getElementById('back-preview').style.display = 'none';
  document.getElementById('back-remove-btn').style.display = 'none';
  document.getElementById('empty-state').style.display = 'flex';
  const w = document.getElementById('sheets-wrapper');
  w.style.display = 'none'; w.innerHTML = '';
  toast(t('toast_cleared'));
}

function doPrint() {
  if (!document.getElementById('sheets-wrapper').children.length) { toast(t('toast_print_first')); return; }
  window.print();
}

function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 2600);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SAVE AS PDF
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function savePDF() {
  const sheets = document.querySelectorAll('#sheets-wrapper .sheet-block');
  if (!sheets.length) { toast(t('toast_print_first')); return; }
  const overlay = document.getElementById('pdf-overlay');
  const fillEl  = document.getElementById('pdf-progress-fill');
  const labelEl = document.getElementById('pdf-progress-label');
  const subEl   = document.getElementById('pdf-sub');
  function setProgress(pct, msg) {
    fillEl.style.width = pct + '%';
    labelEl.textContent = pct + ' %';
    if (msg) subEl.textContent = msg;
  }
  overlay.classList.add('visible');
  setProgress(0, t('pdf_init'));
  await new Promise(r => setTimeout(r, 80));
  try {
    const { jsPDF } = window.jspdf;
    const isLandscape = pdfOrient === 'landscape';
    const pdf = new jsPDF({ orientation: pdfOrient, unit: 'mm', format: 'a4' });
    // A4: portrait = 210Ã—297, landscape = 297Ã—210
    const pageW = isLandscape ? 297 : 210;
    const pageH = isLandscape ? 210 : 297;
    const margin = 8;
    const total = sheets.length;
    for (let i = 0; i < total; i++) {
      const sheet = sheets[i];
      setProgress(Math.round((i / total) * 80), t('pdf_processing', {i: i+1, total}));
      const header = sheet.querySelector('.sheet-header');
      const note   = sheet.querySelector('.print-note');
      const hd = header ? header.style.display : null;
      const nd = note   ? note.style.display   : null;
      if (header) header.style.display = 'none';
      if (note)   note.style.display   = 'none';
      const canvas = await html2canvas(sheet, {
        scale: 3, useCORS: true, allowTaint: true, backgroundColor: '#ffffff', logging: false, imageTimeout: 30000,
        onclone: (cloneDoc) => {
          cloneDoc.querySelectorAll('.cut-grid,.grid-cell').forEach(el => { el.style.borderStyle='solid'; el.style.borderColor='#BBBBBB'; });
          cloneDoc.querySelectorAll('.scissors-row,.col-scissors-cell,.scissors-margin').forEach(el => { el.style.display='none'; });
        }
      });
      if (header) header.style.display = hd ?? '';
      if (note)   note.style.display   = nd ?? '';
      if (i > 0) pdf.addPage();
      // Fit canvas into page respecting orientation
      const availW = pageW - margin * 2;
      const availH = pageH - margin * 2;
      const cr = canvas.width / canvas.height;
      const ar = availW / availH;
      let imgW, imgH;
      if (cr > ar) { imgW = availW; imgH = availW / cr; }
      else         { imgH = availH; imgW = availH * cr; }
      const x = margin + (availW - imgW) / 2;
      const y = margin + (availH - imgH) / 2;
      pdf.addImage(canvas.toDataURL('image/jpeg', 0.95), 'JPEG', x, y, imgW, imgH);
      pdf.setFontSize(7); pdf.setTextColor(180,180,180);
      const lbl = i%2===0 ? t('pdf_label_front',{n:Math.floor(i/2)+1}) : t('pdf_label_back',{n:Math.floor(i/2)+1});
      pdf.text(lbl, pageW/2, pageH-3, {align:'center'});
    }
    setProgress(95, t('pdf_saving'));
    await new Promise(r => setTimeout(r, 100));
    const title = (document.getElementById('game-title').value || 'pexeso').replace(/\s+/g,'-');
    pdf.save(`${title}.pdf`);
    setProgress(100, t('pdf_done'));
    await new Promise(r => setTimeout(r, 700));
    toast(t('toast_pdf_saved'));
  } catch (err) {
    console.error('PDF error:', err);
    toast(t('toast_pdf_error'));
  } finally {
    overlay.classList.remove('visible');
    setProgress(0, t('pdf_preparing'));
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Detect saved language or browser language
const savedLang = localStorage.getItem('pexeso-lang');
const browserLang = navigator.language.slice(0,2);
const supported = ['cs','en','sk','pl','de'];
currentLang = savedLang || (supported.includes(browserLang) ? browserLang : 'cs');

setLang(currentLang);
initSwatches();
setBorderStyle(document.querySelector('#border-style-group .icon-btn'));
// Set default game title in detected language
document.getElementById('game-title').value = t('default_title');
updatePreview();
</script>
</body>
</html>
