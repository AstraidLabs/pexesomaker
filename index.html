<!DOCTYPE html>
<html lang="cs" id="html-root">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pexeso Maker</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root {
  --bg: #FFF8F0;
  --ink: #1C1917;
  --orange: #F97316;
  --teal: #0D9488;
  --red: #EF4444;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--ink);
  min-height: 100vh;
}
body::before {
  content: '';
  position: fixed; inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E");
  pointer-events: none; z-index: 0;
}

/* HEADER */
.header {
  background: var(--ink); color: #FFF8F0;
  padding: 0.8rem 1.5rem;
  display: flex; align-items: center; gap: 0.8rem;
  position: relative; z-index: 10;
  border-bottom: 4px solid var(--orange);
}
.header-logo {
  font-family: 'Baloo 2', cursive; font-size: 1.5rem; font-weight: 800;
  display: flex; align-items: center; gap: 0.5rem;
}

/* Header title + version stacked */
.header-logo-text{
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  line-height: 1;
  gap: 0.06rem;
}
.header-logo-title{
  line-height: 1;
}
.header-version{
  font-family: 'DM Sans', sans-serif;
  font-size: 0.62rem;
  font-weight: 800;
  line-height: 1;
  align-self: flex-start;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.20rem 0.55rem;
  border-radius: 999px;
  background: linear-gradient(135deg, rgba(14,165,164,0.22) 0%, rgba(56,189,248,0.16) 45%, rgba(249,115,22,0.18) 100%);
  color: #0f172a;
  border: 1px solid rgba(14,165,164,0.30);
  box-shadow:
    0 1px 0 rgba(255,255,255,0.92) inset,
    0 6px 14px rgba(15,23,42,0.06);
  letter-spacing: .04em;
  text-transform: uppercase;
  white-space: nowrap;
}

.sidebar-release{
  margin-top: 0.9rem;
  padding-top: 0.8rem;
  border-top: 1px dashed rgba(148,163,184,0.35);
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 0.45rem;
}

.sidebar-release-label{
  font-size: 0.72rem;
  color: #64748b;
  font-weight: 600;
}

@media (max-width: 980px){
  .sidebar-release{
    justify-content: flex-start;
    margin-top: 0.6rem;
  }
}




.scissors-icon {
  background: var(--orange); color: white;
  width: 36px; height: 36px; border-radius: 9px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.1rem; transform: rotate(-15deg); transition: transform 0.3s;
}
.header-logo:hover .scissors-icon { transform: rotate(15deg); }
.header-sub { font-size: 0.75rem; color: #aaa; font-weight: 500; }

/* LANGUAGE SWITCHER */
.lang-switcher {
  margin-left: auto;
  display: flex; align-items: center; gap: 4px;
}
.lang-btn {
  background: none; border: 2px solid transparent;
  border-radius: 7px; cursor: pointer;
  font-size: 0.78rem; font-weight: 700; line-height: 1;
  color: rgba(255,255,255,0.55);
  padding: 4px 7px;
  transition: all 0.15s;
  letter-spacing: 0.3px;
  font-family: 'DM Sans', sans-serif;
}
.lang-btn:hover { color: white; background: rgba(255,255,255,0.1); }
.lang-btn.active {
  color: white;
  border-color: var(--orange);
  background: rgba(249,115,22,0.2);
}

/* HAMBURGER (mobile only) */
.hamburger {
  display: none;
  background: none; border: none; cursor: pointer;
  color: white; padding: 6px; border-radius: 8px;
  transition: background 0.15s; order: -1;
}
.hamburger:hover { background: rgba(255,255,255,0.1); }
.hamburger svg { display: block; }

/* SIDEBAR OVERLAY (mobile) */
.sidebar-overlay {
  display: none;
  position: fixed; inset: 0; z-index: 199;
  background: rgba(28,25,23,0.5);
  backdrop-filter: blur(2px);
}
.sidebar-overlay.visible { display: block; }

/* SIDEBAR CLOSE BUTTON (mobile) */
.sidebar-close {
  display: none;
  position: absolute; top: 0.8rem; right: 0.8rem;
  background: #F3F4F6; border: none; border-radius: 50%;
  width: 30px; height: 30px; cursor: pointer;
  font-size: 0.85rem; color: #666;
  align-items: center; justify-content: center;
  transition: background 0.15s; z-index: 10;
}
.sidebar-close:hover { background: #E5E7EB; }

/* LAYOUT */
.app {
  display: grid;
  grid-template-columns: 330px 1fr;
  min-height: calc(100vh - 65px);
  position: relative;
  /* z-index removed: allows mobile sidebar (z-index:200) to sit above the overlay */
  }

/* SIDEBAR */
.sidebar {
  background: white;
  border-right: 2px solid #E8E0D8;
  padding: 1.2rem;
  display: flex; flex-direction: column; gap: 0;
  overflow-y: auto;
  max-height: calc(100vh - 65px);
  position: sticky; top: 65px; align-self: start;
}
.sidebar::-webkit-scrollbar { width: 3px; }
.sidebar::-webkit-scrollbar-thumb { background: #E0D8D0; border-radius: 4px; }

/* MOBILE BOTTOM ACTION BAR */
.mobile-actions {
  display: none;
  position: fixed; bottom: 0; left: 0; right: 0; z-index: 150;
  background: white;
  border-top: 2px solid #E8E0D8;
  padding: 0.7rem 1rem;
  gap: 0.5rem;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
}
.mobile-actions .btn {
  flex: 1; padding: 0.65rem 0.5rem; font-size: 0.82rem;
}

/* ‚îÄ‚îÄ TABLET: 768px‚Äì1024px ‚îÄ‚îÄ */
@media (max-width: 1024px) and (min-width: 769px) {
  .app { grid-template-columns: 280px 1fr; }
  .header-sub { display: none; }
}

/* ‚îÄ‚îÄ MOBILE: ‚â§ 768px ‚îÄ‚îÄ */
@media (max-width: 768px) {
  /* Header */
  .header { padding: 0.7rem 1rem; gap: 0.5rem; }
  .header-logo { font-size: 1.2rem; }
  .scissors-icon { width: 30px; height: 30px; font-size: 0.95rem; }
  .header-sub { display: none; }
  .lang-btn { font-size: 0.7rem; padding: 3px 5px; }
  .hamburger { display: flex; }

  /* Layout: single column, sidebar hidden */
  .app { grid-template-columns: 1fr; }

  /* Sidebar becomes a slide-in drawer */
  .sidebar {
    position: fixed;
    top: 0; left: 0; bottom: 0;
    width: min(85vw, 340px);
    max-height: 100vh;
    z-index: 200;
    transform: translateX(-110%);
    transition: transform 0.28s cubic-bezier(0.4, 0, 0.2, 1);
    border-right: 2px solid #E8E0D8;
    padding-top: 3rem;
    box-shadow: 4px 0 30px rgba(0,0,0,0.15);
  }
  .sidebar.open { transform: translateX(0); }
  .sidebar-close { display: flex; }

  /* Main takes full width, add bottom padding for action bar */
  .main { padding: 1rem; padding-bottom: 80px; }

  /* Sheets fit on screen */
  .sheets-wrapper { gap: 1.5rem; }
  .sheet-block { border-radius: 10px; }
  .sheet-header { flex-wrap: wrap; gap: 0.4rem; padding: 0.6rem 0.8rem; }
  .sheet-tip { margin-left: 0; }
  .sheet-body { padding: 0.7rem; }

  /* Cut grid: allow horizontal scroll */
  .cut-outer { overflow-x: auto; -webkit-overflow-scrolling: touch; }

  /* Empty state */
  .empty-state { min-height: 60vh; }
  .empty-state .big { font-size: 3rem; }
  .empty-state h2 { font-size: 1.3rem; }

  /* Hide btn-row in sidebar on mobile (moved to bottom bar) */
  .btn-row { display: none; }

  /* Show mobile action bar */
  .mobile-actions { display: flex; }

  /* Thumb grid: 5 columns when sidebar is wide */
  .thumb-grid { grid-template-columns: repeat(5, 1fr); }

  /* Warn/PDF overlays: full screen on small phones */
  .warn-box { padding: 1.5rem 1.2rem; border-radius: 16px; }
  .pdf-overlay-box { padding: 2rem 1.5rem; min-width: unset; width: 85vw; }
}

/* ‚îÄ‚îÄ VERY SMALL: ‚â§ 380px ‚îÄ‚îÄ */
@media (max-width: 380px) {
  .lang-btn { padding: 2px 4px; font-size: 0.65rem; }
  .mobile-actions .btn { font-size: 0.72rem; padding: 0.55rem 0.3rem; }
}

/* ACCORDION */
.acc-section { border-bottom: 1px solid #F0EBE5; }
.acc-header {
  display: flex; align-items: center; gap: 0.5rem;
  padding: 0.75rem 0;
  cursor: pointer; user-select: none;
  font-family: 'Baloo 2', cursive;
  font-size: 0.78rem; font-weight: 700;
  letter-spacing: 1px; text-transform: uppercase; color: #9CA3AF;
  transition: color 0.15s;
}
.acc-header:hover { color: var(--orange); }
.acc-header .num {
  width: 20px; height: 20px; border-radius: 6px;
  background: #F3F4F6; color: var(--ink);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.7rem; font-weight: 800; flex-shrink: 0;
}
.acc-header .num.done { background: var(--orange); color: white; }
.acc-chevron { margin-left: auto; font-size: 0.65rem; color: #ccc; transition: transform 0.2s; }
.acc-section.open .acc-chevron { transform: rotate(90deg); }
.acc-body { display: none; padding-bottom: 1rem; }
.acc-section.open .acc-body { display: block; }

/* DROPZONE */
.dropzone {
  border: 2px dashed #D1C7BD; border-radius: 12px;
  padding: 1.2rem 0.8rem; text-align: center;
  cursor: pointer; transition: all 0.2s; background: var(--bg);
}
.dropzone:hover, .dropzone.over { border-color: var(--orange); background: #FFF3E8; }
.dropzone input { display: none; }
.dropzone p { font-size: 0.8rem; color: #888; line-height: 1.4; margin-top: 0.25rem; }
.dropzone strong { color: var(--orange); }

/* THUMBS */
.thumb-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 0.5rem; }
.thumb { aspect-ratio: 1; border-radius: 7px; overflow: hidden; position: relative; border: 2px solid #E8E0D8; }
.thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
.thumb .del {
  position: absolute; top: 2px; right: 2px;
  width: 16px; height: 16px; background: var(--red); color: white;
  border: none; border-radius: 50%; font-size: 0.55rem; font-weight: 900;
  cursor: pointer; display: none; align-items: center; justify-content: center;
}
.thumb:hover .del { display: flex; }
.counter-bar { font-size: 0.78rem; color: #888; font-weight: 600; text-align: center; margin-top: 0.3rem; }
.counter-bar span { color: var(--orange); font-weight: 800; }

/* TABS */
.tabs { display: flex; border: 2px solid #E8E0D8; border-radius: 9px; overflow: hidden; }
.tab-btn {
  flex: 1; padding: 0.45rem; border: none; background: white;
  font-family: 'DM Sans', sans-serif; font-size: 0.8rem; font-weight: 600;
  cursor: pointer; color: #888; transition: all 0.15s;
}
.tab-btn.active { background: var(--ink); color: white; }
.tab-content { display: none; margin-top: 0.6rem; }
.tab-content.active { display: block; }

/* SWATCHES */
.swatch-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 7px; }
.swatch {
  aspect-ratio: 1; border-radius: 9px; cursor: pointer;
  border: 3px solid transparent; transition: all 0.15s; overflow: hidden; position: relative;
}
.swatch:hover { transform: scale(1.05); }
.swatch.active { border-color: var(--ink); box-shadow: 0 0 0 2px var(--ink); }
.swatch-label {
  position: absolute; bottom: 2px; left: 0; right: 0;
  text-align: center; font-size: 0.55rem; font-weight: 700;
  color: rgba(255,255,255,0.9); text-shadow: 0 1px 3px rgba(0,0,0,0.6);
}

/* BACK DROPZONE */
.back-dz {
  border: 2px dashed #D1C7BD; border-radius: 10px;
  padding: 1rem 0.7rem; text-align: center; cursor: pointer;
  background: var(--bg); transition: all 0.2s;
}
.back-dz:hover { border-color: var(--teal); background: #F0FDFB; }
.back-dz input { display: none; }
.back-preview {
  width: 100%; height: 72px; border-radius: 7px; object-fit: cover;
  margin-top: 0.4rem; display: none; border: 2px solid #E8E0D8;
}

/* FORM */
.field { margin-bottom: 0.7rem; }
.field label {
  display: flex; justify-content: space-between; align-items: center;
  font-size: 0.74rem; font-weight: 600; color: #666;
  margin-bottom: 0.25rem; letter-spacing: 0.4px;
}
.field label .val {
  font-size: 0.78rem; font-weight: 800; color: var(--orange);
  background: #FFF3E8; padding: 0.1rem 0.45rem; border-radius: 5px;
  min-width: 36px; text-align: center;
}
.field input[type="text"], .field select {
  width: 100%; padding: 0.48rem 0.75rem;
  border-radius: 9px; border: 2px solid #E8E0D8;
  font-family: 'DM Sans', sans-serif; font-size: 0.88rem;
  font-weight: 500; background: white; outline: none; transition: border-color 0.2s;
}
.field input:focus, .field select:focus { border-color: var(--orange); }

input[type="range"] {
  -webkit-appearance: none; width: 100%; height: 5px;
  border-radius: 3px; background: #E8E0D8; outline: none; cursor: pointer;
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none; width: 16px; height: 16px;
  border-radius: 50%; background: var(--orange);
  border: 2px solid white; box-shadow: 0 1px 4px rgba(0,0,0,0.25); cursor: pointer;
}

/* ICON BUTTON GROUP */
.btn-group { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
.icon-btn {
  padding: 0.45rem 0.2rem; border: 2px solid #E8E0D8; border-radius: 8px;
  background: white; cursor: pointer; text-align: center;
  font-size: 0.65rem; font-weight: 700; color: #888; transition: all 0.15s;
  display: flex; flex-direction: column; align-items: center; gap: 3px;
}
.icon-btn:hover { border-color: var(--orange); color: var(--orange); }
.icon-btn.active { border-color: var(--orange); background: #FFF3E8; color: var(--orange); }

/* TOGGLE */
.toggle-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem; }
.toggle-label { font-size: 0.74rem; font-weight: 600; color: #666; }
.toggle {
  width: 38px; height: 22px; border-radius: 11px;
  background: #E8E0D8; position: relative; cursor: pointer;
  transition: background 0.2s; flex-shrink: 0; border: none;
}
.toggle::after {
  content: ''; position: absolute; top: 3px; left: 3px;
  width: 16px; height: 16px; border-radius: 50%; background: white;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2); transition: left 0.2s;
}
.toggle.on { background: var(--orange); }
.toggle.on::after { left: 19px; }

.color-row { display: flex; align-items: center; gap: 8px; margin-bottom: 0.7rem; }
.color-row label { font-size: 0.74rem; font-weight: 600; color: #666; flex: 1; }
input[type="color"] {
  width: 34px; height: 28px; border-radius: 7px; border: 2px solid #E8E0D8;
  cursor: pointer; padding: 2px; background: white;
}

/* CARD PREVIEW */
.card-preview-wrap {
  display: flex; flex-direction: column; align-items: center; gap: 0.5rem;
  padding: 0.8rem; background: #F8F5F2; border-radius: 10px; margin-bottom: 0.7rem;
}
.card-preview-label { font-size: 0.7rem; font-weight: 700; color: #aaa; text-transform: uppercase; letter-spacing: 1px; }
.card-preview-box { width: 90px; height: 90px; position: relative; }
#card-mini { position: absolute; inset: 0; transition: all 0.2s; }
#card-mini-inner {
  position: absolute; inset: 0;
  background: linear-gradient(135deg, #ddd 0%, #eee 100%);
  display: flex; align-items: center; justify-content: center;
  font-size: 1.4rem; transition: all 0.2s;
}

/* BUTTONS */
.btn {
  width: 100%; padding: 0.7rem 1rem; border-radius: 11px; border: none;
  font-family: 'Baloo 2', cursive; font-size: 1rem; font-weight: 700;
  cursor: pointer; transition: all 0.18s;
  display: flex; align-items: center; justify-content: center; gap: 0.5rem;
}
.btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
.btn:active { transform: translateY(0); }
.btn-generate { background: var(--orange); color: white; }
.btn-pdf { background: linear-gradient(135deg, #7C3AED, #A855F7); color: white; }
.btn-print { background: var(--ink); color: white; }
.btn-clear { background: #F3F4F6; color: #666; }
.btn-clear:hover { box-shadow: none; transform: none; background: #E5E7EB; }
.btn-row { display: flex; flex-direction: column; gap: 0.45rem; padding: 0.8rem 0; }
.divider { height: 1px; background: #F0EBE5; }

/* MAIN */
.main { padding: 1.8rem; overflow-y: auto; }
.empty-state {
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; min-height: 500px; text-align: center; color: #C4BAB0;
}
.empty-state .big { font-size: 4.5rem; }
.empty-state h2 { font-family: 'Baloo 2', cursive; font-size: 1.7rem; margin: 0.5rem 0 0.3rem; color: #D6CECA; }
.empty-state p { font-size: 0.88rem; }

/* SHEET BLOCK */
.sheets-wrapper { display: flex; flex-direction: column; gap: 2.5rem; }
.sheet-block { background: white; border-radius: 14px; box-shadow: 0 4px 30px rgba(0,0,0,0.08); border: 1px solid #E8E0D8; overflow: hidden; }
.sheet-header {
  display: flex; align-items: center; gap: 0.7rem;
  padding: 0.8rem 1.2rem; border-bottom: 2px solid #F3F4F6; background: #FAFAF9;
}
.sheet-badge {
  background: var(--orange); color: white;
  font-family: 'Baloo 2', cursive; font-size: 0.75rem; font-weight: 700;
  padding: 0.2rem 0.65rem; border-radius: 50px;
}
.sheet-badge.back { background: var(--teal); }
.sheet-info { font-size: 0.8rem; color: #888; }
.sheet-tip { margin-left: auto; font-size: 0.75rem; background: #FFF3E8; color: var(--orange); padding: 0.2rem 0.65rem; border-radius: 50px; font-weight: 600; }
.sheet-tip.back { background: #F0FDFB; color: var(--teal); }
.sheet-body { padding: 1.2rem; }

/* CUT GRID */
.cut-outer { display: flex; gap: 0; align-items: flex-start; overflow-x: auto; }
.scissors-margin { display: flex; flex-direction: column; }
.scissors-row { display: flex; align-items: center; justify-content: center; color: #CCC; font-size: 0.8rem; flex-shrink: 0; }
.col-scissors { display: flex; }
.col-scissors-cell { display: flex; align-items: center; justify-content: center; color: #CCC; font-size: 0.8rem; flex-shrink: 0; padding: 3px 0; }
.cut-grid { display: grid; border-top: 2px dashed #BBBBB5; border-left: 2px dashed #BBBBB5; }
/* Row-based layout for print safety */
.cut-grid-wrap { border-top: 2px dashed #BBBBB5; border-left: 2px dashed #BBBBB5; display: inline-block; }
.cut-row {
  display: flex;
  break-inside: avoid;
  page-break-inside: avoid;
}
.grid-cell { position: relative; overflow: visible; border-right: 2px dashed #BBBBB5; border-bottom: 2px dashed #BBBBB5; display: flex; align-items: center; justify-content: center; }
.grid-cell::before, .grid-cell::after { content: ''; position: absolute; width: 5px; height: 5px; border-radius: 50%; background: rgba(170,170,165,0.5); z-index: 2; }
.grid-cell::before { top: 0; left: 0; transform: translate(-50%,-50%); }
.grid-cell::after { bottom: 0; right: 0; transform: translate(50%,50%); }
.card-body { position: absolute; overflow: hidden; transition: all 0.15s; }
.card-body img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; display: block; pointer-events: none; }

.print-note { margin-top: 0.7rem; padding: 0.6rem 0.9rem; background: #FFF8F0; border-left: 3px solid var(--orange); border-radius: 0 7px 7px 0; font-size: 0.79rem; color: #666; line-height: 1.5; }
.print-note strong { color: var(--ink); }

/* TOAST */
.toast {
  position: fixed; bottom: 2rem; left: 50%;
  transform: translateX(-50%) translateY(8px);
  background: var(--ink); color: white;
  padding: 0.6rem 1.3rem; border-radius: 50px;
  font-weight: 600; font-size: 0.85rem;
  opacity: 0; transition: all 0.3s; pointer-events: none; z-index: 9999;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* WARNING MODAL */
.warn-overlay {
  position: fixed; inset: 0; background: rgba(28,25,23,0.65); backdrop-filter: blur(3px);
  z-index: 88888; display: none; align-items: center; justify-content: center;
}
.warn-overlay.visible { display: flex; }
.warn-box { background: white; border-radius: 20px; padding: 2rem 2.2rem; max-width: 360px; width: 90%; box-shadow: 0 16px 50px rgba(0,0,0,0.3); text-align: center; }
.warn-box .warn-icon { font-size: 2.8rem; margin-bottom: 0.6rem; }
.warn-box h3 { font-family: 'Baloo 2', cursive; font-size: 1.2rem; color: #1C1917; margin-bottom: 0.5rem; }
.warn-box p { font-size: 0.85rem; color: #666; line-height: 1.55; margin-bottom: 1.3rem; }
.warn-box p strong { color: #D97706; }
.warn-actions { display: flex; gap: 0.6rem; }
.warn-actions .btn { font-size: 0.9rem; padding: 0.6rem 0.8rem; }
.btn-warn-cancel { background: #F3F4F6; color: #666; }
.btn-warn-cancel:hover { background: #E5E7EB; box-shadow: none; transform: none; }
.btn-warn-proceed { background: #D97706; color: white; flex: 1; }

/* PDF OVERLAY */
.pdf-overlay {
  position: fixed; inset: 0; background: rgba(28,25,23,0.75); backdrop-filter: blur(4px);
  z-index: 99999; display: none; flex-direction: column; align-items: center; justify-content: center; gap: 1.2rem;
}
.pdf-overlay.visible { display: flex; }
.pdf-overlay-box { background: white; border-radius: 20px; padding: 2.5rem 3rem; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.4); min-width: 280px; }
.pdf-overlay-box .pdf-icon { font-size: 3rem; margin-bottom: 0.5rem; }
.pdf-overlay-box h3 { font-family: 'Baloo 2', cursive; font-size: 1.3rem; color: #1C1917; margin-bottom: 0.4rem; }
.pdf-overlay-box .pdf-sub { font-size: 0.84rem; color: #999; margin-bottom: 1.2rem; }
.pdf-progress-track { width: 100%; height: 8px; background: #F3F4F6; border-radius: 4px; overflow: hidden; margin-bottom: 0.5rem; }
.pdf-progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #7C3AED, #A855F7); border-radius: 4px; transition: width 0.4s ease; }
.pdf-progress-label { font-size: 0.78rem; font-weight: 700; color: #7C3AED; }

/* PRINT */
@media print {
  @page { margin: 8mm; size: A4; }
  body { background: white !important; }
  body::before { display: none !important; }
  .header, .sidebar, .sheet-header, .print-note, .toast, .mobile-actions, .sidebar-overlay { display: none !important; }
  .app { display: block !important; }
  .main { padding: 0 !important; overflow: visible !important; }
  .sheets-wrapper { gap: 0 !important; }
  .sheet-block { box-shadow: none !important; border: none !important; border-radius: 0 !important; page-break-after: always; break-after: page; }
  .sheet-block:last-child { page-break-after: avoid; break-after: avoid; }
  .sheet-body { padding: 0 !important; width: auto !important; max-width: 100% !important; }
  .cut-grid, .cut-grid-wrap { border-color: #999 !important; print-color-adjust: exact; -webkit-print-color-adjust: exact; }
  .cut-row { break-inside: avoid !important; page-break-inside: avoid !important; }
  .grid-cell { border-color: #999 !important; print-color-adjust: exact; -webkit-print-color-adjust: exact; }
  .card-body { print-color-adjust: exact; -webkit-print-color-adjust: exact; }
  .scissors-row, .col-scissors-cell { color: #999 !important; }
  .cut-outer { overflow: visible !important; display: block !important; }
  /* Make the "left scissors + grid" layout stable in print (avoid flex fragmentation) */
  .scissors-margin, .cut-cols { display: inline-block !important; vertical-align: top !important; }
  /* Remove overflow containers that can cause page splitting/clipping */
  .grid-wrapper { overflow: visible !important; }
  /* Stronger anti-split rules for print pagination engines */
  .sheet-block, .sheet-body, .grid-wrapper, .cut-outer, .scissors-margin, .cut-cols,
  .col-scissors, .cut-grid-wrap, .cut-row, .grid-cell {
    break-inside: avoid !important;
    page-break-inside: avoid !important;
  }
}

/* STARTUP TERMS MODAL */
body.modal-open { overflow: hidden; }

.start-overlay{
  position: fixed; inset: 0;
  background: rgba(28,25,23,0.70);
  backdrop-filter: blur(4px);
  z-index: 77777;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 1.2rem;
}
.start-overlay.visible{ display:flex; }

.start-box{
  background: #fff;
  border-radius: 22px;
  width: min(560px, 100%);
  box-shadow: 0 18px 60px rgba(0,0,0,0.35);
  padding: 1.6rem 1.6rem 1.3rem;
  position: relative;
}
.start-badge{ font-size: 2.2rem; margin-bottom: 0.35rem; }
.start-box h2{
  font-family: 'Baloo 2', cursive;
  font-size: 1.35rem;
  margin-bottom: 0.45rem;
}
.start-lead{
  font-size: 0.95rem;
  color: #444;
  line-height: 1.55;
  margin-bottom: 0.9rem;
}
.start-terms{
  background: #F8FAFC;
  border: 1px solid #E5E7EB;
  border-radius: 16px;
  padding: 0.9rem 1rem;
  margin-bottom: 1rem;
}
.start-terms h3{
  font-family: 'Baloo 2', cursive;
  font-size: 1.05rem;
  margin-bottom: 0.45rem;
}
.start-terms ul{
  margin-left: 1.1rem;
  color: #555;
  line-height: 1.55;
  font-size: 0.9rem;
}
.start-terms li{ margin: 0.25rem 0; }
.start-terms .muted{ color:#6b7280; font-size:0.85rem; margin-top:0.55rem; }

.start-check{
  display: flex;
  gap: 0.6rem;
  align-items: flex-start;
  margin-bottom: 1rem;
  font-size: 0.92rem;
  color: #333;
}
.start-check input{
  margin-top: 0.18rem;
  width: 18px;
  height: 18px;
  accent-color: var(--teal);
}

.start-actions{
  display: flex;
  gap: 0.65rem;
  justify-content: flex-end;
}
.start-actions .btn{ padding: 0.7rem 0.95rem; font-size: 0.95rem; }
.start-actions .btn-primary{ background: var(--teal); color: #fff; flex: 1; }
.start-actions .btn-primary:disabled{ opacity: 0.45; cursor: not-allowed; transform: none; box-shadow: none; }
.start-actions .btn-ghost{ background: #F3F4F6; color: #333; }
.start-actions .btn-ghost:hover{ background: #E5E7EB; box-shadow: none; transform: none; }

.start-support{
  margin-top: 0.9rem;
  display: none;
  background: #FFF7ED;
  border: 1px solid #FED7AA;
  border-radius: 16px;
  padding: 0.85rem 1rem;
}
.start-support.visible{ display:block; }
.start-support p{ font-size: 0.9rem; color:#7c2d12; line-height: 1.55; margin-bottom: 0.55rem; }
.start-support a{
  display: inline-block;
  font-size: 0.92rem;
  font-weight: 700;
  color: #9a3412;
  text-decoration: none;
}
.start-support a:hover{ text-decoration: underline; }

@media (max-width: 560px){
  .start-box{ padding: 1.35rem 1.25rem 1.1rem; }
  .start-actions{ flex-direction: column; }
  .start-actions .btn{ width: 100%; }
}


/* Multi-page preview tweaks */
.sheets-wrapper { flex-wrap: wrap; }
.sheet-block { flex: 0 0 auto; }


/* ‚ú® Micro-animations / hover effects (UI polish) */
@keyframes uiFadeUp {
  from { opacity: 0; transform: translateY(10px) scale(0.995); }
  to   { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes uiPopIn {
  from { opacity: 0; transform: scale(0.94); }
  to   { opacity: 1; transform: scale(1); }
}
@keyframes uiSlideInRight {
  from { opacity: 0; transform: translateX(14px); }
  to   { opacity: 1; transform: translateX(0); }
}
@keyframes uiPulseGlow {
  0%, 100% { box-shadow: 0 0 0 0 rgba(14,165,164,0); }
  50%      { box-shadow: 0 0 0 8px rgba(14,165,164,0.06); }
}

/* Smooth defaults */
.btn,
.lang-btn,
.tab-btn,
.acc-header,
.dropzone,
.thumb,
.thumb img,
.thumb .del,
.sheet-block,
.sheet-badge,
.sheet-tip,
.sidebar-close,
.scissors-icon,
.header-logo,
.header-version,
.sidebar-release,
.mobile-actions,
.warn-box,
.pdf-overlay-box,
.start-box {
  transition:
    transform .18s ease,
    box-shadow .22s ease,
    background-color .22s ease,
    border-color .22s ease,
    color .18s ease,
    opacity .18s ease,
    filter .22s ease;
  will-change: transform;
}

/* Header / logo */
.header-logo:hover .scissors-icon {
  transform: rotate(-12deg) scale(1.04);
}
.header-logo:hover .header-logo-title {
  filter: brightness(0.96);
}

/* Buttons */
.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 16px rgba(15,23,42,0.08);
}
.btn:active {
  transform: translateY(0) scale(0.985);
}
.btn:focus-visible,
.lang-btn:focus-visible,
.tab-btn:focus-visible,
.sidebar-close:focus-visible {
  outline: 2px solid rgba(14,165,164,0.45);
  outline-offset: 2px;
}

/* Language + tabs */
.lang-btn:hover,
.tab-btn:hover {
  transform: translateY(-1px);
}
.lang-btn.active,
.tab-btn.active {
  box-shadow: 0 4px 10px rgba(15,23,42,0.08);
}

/* Accordion */
.acc-section {
  transition: background-color .22s ease, border-color .22s ease;
}
.acc-header:hover {
  color: var(--ink);
  transform: translateX(2px);
}
.acc-header:hover .acc-chevron {
  transform: translateX(2px);
}
.acc-header:active {
  transform: translateX(0);
}

/* Dropzone */
.dropzone {
  transform-origin: center;
}
.dropzone:hover {
  transform: translateY(-1px);
  box-shadow: 0 10px 18px rgba(15,23,42,0.05);
}
.dropzone.over {
  animation: uiPulseGlow .7s ease;
}

/* Thumbnail grid */
.thumb {
  animation: uiPopIn .18s ease both;
}
.thumb:hover {
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 8px 14px rgba(15,23,42,0.08);
  border-color: rgba(14,165,164,0.35);
}
.thumb:hover img {
  transform: scale(1.04);
}
.thumb .del {
  opacity: 0;
  transform: scale(0.85);
}
.thumb:hover .del {
  opacity: 1;
  transform: scale(1);
}
.thumb .del:hover {
  transform: scale(1.08);
  filter: brightness(1.05);
}

/* Generated sheets / preview */
.sheets-wrapper > .sheet-block {
  animation: uiFadeUp .28s ease both;
}
.sheets-wrapper > .sheet-block:nth-child(1)  { animation-delay: .02s; }
.sheets-wrapper > .sheet-block:nth-child(2)  { animation-delay: .05s; }
.sheets-wrapper > .sheet-block:nth-child(3)  { animation-delay: .08s; }
.sheets-wrapper > .sheet-block:nth-child(4)  { animation-delay: .11s; }
.sheets-wrapper > .sheet-block:nth-child(5)  { animation-delay: .14s; }
.sheets-wrapper > .sheet-block:nth-child(6)  { animation-delay: .17s; }
.sheets-wrapper > .sheet-block:nth-child(7)  { animation-delay: .20s; }
.sheets-wrapper > .sheet-block:nth-child(8)  { animation-delay: .23s; }
.sheets-wrapper > .sheet-block:nth-child(9)  { animation-delay: .26s; }
.sheets-wrapper > .sheet-block:nth-child(10) { animation-delay: .29s; }
.sheets-wrapper > .sheet-block:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 28px rgba(15,23,42,0.09);
}
.sheet-badge:hover,
.sheet-tip:hover {
  transform: translateY(-1px);
}

/* Sidebar footer release badge */
.sidebar-release:hover .header-version {
  transform: translateY(-1px);
  box-shadow:
    0 1px 0 rgba(255,255,255,0.92) inset,
    0 10px 18px rgba(15,23,42,0.08);
}

/* Modals */
.warn-box,
.pdf-overlay-box,
.start-box {
  animation: uiPopIn .22s ease both;
}
.warn-overlay.visible .warn-box,
.pdf-overlay.visible .pdf-overlay-box,
.start-overlay.visible .start-box {
  animation: uiPopIn .22s ease both;
}
.sidebar.open {
  animation: uiSlideInRight .18s ease both;
}
.mobile-actions {
  animation: uiFadeUp .2s ease both;
}

/* Respect reduced motion + print */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation: none !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}
@media print {
  *, *::before, *::after {
    animation: none !important;
    transition: none !important;
    transform: none !important;
    box-shadow: none !important;
    filter: none !important;
  }
}


/* üéõÔ∏è Button FX pack (hover / shine / press) */
.btn{
  position: relative;
  overflow: hidden;
  isolation: isolate;
  transform-origin: center;
  backface-visibility: hidden;
}

.btn::before{
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: radial-gradient(circle at 18% 12%, rgba(255,255,255,0.22), transparent 44%);
  opacity: .7;
  pointer-events: none;
  z-index: 0;
  transition: opacity .22s ease, transform .22s ease;
}

.btn::after{
  content: "";
  position: absolute;
  top: -20%;
  left: -35%;
  width: 34%;
  height: 140%;
  border-radius: 999px;
  background: linear-gradient(
    90deg,
    rgba(255,255,255,0) 0%,
    rgba(255,255,255,.18) 42%,
    rgba(255,255,255,.44) 50%,
    rgba(255,255,255,.18) 58%,
    rgba(255,255,255,0) 100%
  );
  transform: translateX(-180%) rotate(14deg);
  opacity: 0;
  pointer-events: none;
  z-index: 0;
}

.btn > *{
  position: relative;
  z-index: 1;
}

.btn:hover{
  transform: translateY(-2px) scale(1.01);
  box-shadow: 0 10px 20px rgba(15,23,42,0.10), 0 2px 6px rgba(15,23,42,0.06);
}

.btn:hover::before{
  opacity: .95;
  transform: scale(1.01);
}

.btn:hover::after{
  opacity: 1;
  animation: btnShineSweep .9s ease;
}

.btn:active{
  transform: translateY(0) scale(.985);
  box-shadow: 0 4px 10px rgba(15,23,42,0.08);
}

.btn:active::before{
  opacity: .55;
}

.btn:disabled,
.btn[disabled]{
  cursor: not-allowed;
  transform: none !important;
  box-shadow: none !important;
}

.btn:disabled::after,
.btn[disabled]::after{
  display: none;
}

/* Variant-specific accents */
.btn-generate:hover{
  box-shadow:
    0 10px 22px rgba(14,165,164,0.22),
    0 0 0 3px rgba(14,165,164,0.08);
}
.btn-generate:hover::before{
  background: radial-gradient(circle at 18% 12%, rgba(255,255,255,0.26), transparent 44%),
              linear-gradient(135deg, rgba(14,165,164,0.10), rgba(255,255,255,0));
}

.btn-print:hover{
  box-shadow:
    0 10px 22px rgba(56,189,248,0.18),
    0 0 0 3px rgba(56,189,248,0.08);
}

.btn-clear:hover{
  box-shadow:
    0 10px 22px rgba(249,115,22,0.18),
    0 0 0 3px rgba(249,115,22,0.08);
}

/* Extra punch in mobile fixed action bar */
.mobile-actions .btn:hover{
  transform: translateY(-3px) scale(1.015);
}

@keyframes btnShineSweep{
  0%   { transform: translateX(-180%) rotate(14deg); }
  100% { transform: translateX(520%) rotate(14deg); }
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce){
  .btn::after{ animation: none !important; }
  .btn:hover::after{ opacity: 0 !important; }
}
@media print{
  .btn::before, .btn::after{ display: none !important; }
}


/* üéöÔ∏è Slider FX pack (range inputs) */
input[type="range"]{
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 10px;
  border-radius: 999px;
  background:
    linear-gradient(90deg, rgba(14,165,164,0.24), rgba(56,189,248,0.20)) 0 / var(--range-fill, 0%) 100% no-repeat,
    linear-gradient(180deg, rgba(255,255,255,0.95), rgba(241,245,249,0.95));
  border: 1px solid rgba(148,163,184,0.32);
  box-shadow:
    inset 0 1px 2px rgba(15,23,42,0.05),
    0 1px 0 rgba(255,255,255,0.9);
  transition:
    box-shadow .2s ease,
    border-color .2s ease,
    transform .18s ease,
    background-size .15s ease;
  cursor: pointer;
}

input[type="range"]:hover{
  border-color: rgba(14,165,164,0.35);
  box-shadow:
    inset 0 1px 2px rgba(15,23,42,0.05),
    0 0 0 3px rgba(14,165,164,0.06);
}

input[type="range"]:focus-visible{
  outline: none;
  border-color: rgba(14,165,164,0.42);
  box-shadow:
    inset 0 1px 2px rgba(15,23,42,0.05),
    0 0 0 4px rgba(14,165,164,0.12);
}

input[type="range"].range-active{
  transform: scaleY(1.04);
}

input[type="range"]::-webkit-slider-runnable-track{
  -webkit-appearance: none;
  height: 10px;
  background: transparent;
  border-radius: 999px;
}

input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  margin-top: -6px; /* centers thumb on 10px track */
  border-radius: 50%;
  border: 1px solid rgba(14,165,164,0.28);
  background:
    radial-gradient(circle at 30% 28%, rgba(255,255,255,0.96), rgba(255,255,255,0.72) 35%, rgba(255,255,255,0) 36%),
    linear-gradient(180deg, #ffffff 0%, #f8fafc 48%, #eef2f7 100%);
  box-shadow:
    0 3px 8px rgba(15,23,42,0.14),
    0 0 0 4px rgba(14,165,164,0.00);
  transition: transform .14s ease, box-shadow .2s ease, border-color .2s ease, filter .2s ease;
}

input[type="range"]:hover::-webkit-slider-thumb{
  transform: scale(1.06);
  border-color: rgba(14,165,164,0.38);
  box-shadow:
    0 4px 10px rgba(15,23,42,0.16),
    0 0 0 5px rgba(14,165,164,0.08);
}

input[type="range"]:active::-webkit-slider-thumb,
input[type="range"].range-active::-webkit-slider-thumb{
  transform: scale(1.12);
  box-shadow:
    0 4px 10px rgba(15,23,42,0.16),
    0 0 0 6px rgba(14,165,164,0.14);
}

input[type="range"]::-moz-range-track{
  height: 10px;
  border-radius: 999px;
  background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(241,245,249,0.95));
  border: 1px solid rgba(148,163,184,0.32);
  box-shadow: inset 0 1px 2px rgba(15,23,42,0.05);
}

input[type="range"]::-moz-range-progress{
  height: 10px;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(14,165,164,0.24), rgba(56,189,248,0.20));
}

input[type="range"]::-moz-range-thumb{
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 1px solid rgba(14,165,164,0.28);
  background:
    radial-gradient(circle at 30% 28%, rgba(255,255,255,0.96), rgba(255,255,255,0.72) 35%, rgba(255,255,255,0) 36%),
    linear-gradient(180deg, #ffffff 0%, #f8fafc 48%, #eef2f7 100%);
  box-shadow:
    0 3px 8px rgba(15,23,42,0.14),
    0 0 0 4px rgba(14,165,164,0.00);
  transition: transform .14s ease, box-shadow .2s ease, border-color .2s ease, filter .2s ease;
}

input[type="range"]:hover::-moz-range-thumb{
  transform: scale(1.06);
  border-color: rgba(14,165,164,0.38);
  box-shadow:
    0 4px 10px rgba(15,23,42,0.16),
    0 0 0 5px rgba(14,165,164,0.08);
}

input[type="range"]:active::-moz-range-thumb,
input[type="range"].range-active::-moz-range-thumb{
  transform: scale(1.12);
  box-shadow:
    0 4px 10px rgba(15,23,42,0.16),
    0 0 0 6px rgba(14,165,164,0.14);
}

/* Subtle "live" value emphasis near sliders (common value labels IDs like *-val) */
[id$="-val"]{
  transition: transform .16s ease, color .2s ease, opacity .2s ease;
}
.range-value-pulse{
  transform: scale(1.05);
  color: var(--teal-dark);
}

@media (prefers-reduced-motion: reduce){
  input[type="range"],
  input[type="range"]::-webkit-slider-thumb,
  input[type="range"]::-moz-range-thumb,
  [id$="-val"]{
    transition: none !important;
  }
}
@media print{
  input[type="range"]{
    box-shadow: none !important;
    background: #eee !important;
  }
  input[type="range"]::-webkit-slider-thumb,
  input[type="range"]::-moz-range-thumb{
    box-shadow: none !important;
  }
}

</style>
</head>
<body>

<div class="header">
  <button class="hamburger" onclick="toggleSidebar()" aria-label="Menu">
    <svg width="22" height="22" fill="none" stroke="white" stroke-width="2" stroke-linecap="round">
      <line x1="3" y1="6" x2="19" y2="6"/><line x1="3" y1="11" x2="19" y2="11"/><line x1="3" y1="16" x2="19" y2="16"/>
    </svg>
  </button>
  <div class="header-logo">
    <div class="scissors-icon">‚úÇ</div>
    <div class="header-logo-text">
      <span class="header-logo-title">Pexeso Maker</span>
    </div>
  </div>
  <span class="header-sub" data-i18n="header_sub"></span>
  <div class="lang-switcher">
    <button class="lang-btn active" data-lang="cs" onclick="setLang('cs')" title="ƒåe≈°tina">CS</button>
    <button class="lang-btn" data-lang="en" onclick="setLang('en')" title="English">EN</button>
    <button class="lang-btn" data-lang="sk" onclick="setLang('sk')" title="Slovenƒçina">SK</button>
    <button class="lang-btn" data-lang="pl" onclick="setLang('pl')" title="Polski">PL</button>
    <button class="lang-btn" data-lang="de" onclick="setLang('de')" title="Deutsch">DE</button>
  </div>
</div>

<div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>
<div class="app">
<div class="sidebar" id="sidebar">
  <button class="sidebar-close" onclick="closeSidebar()">‚úï</button>
  <!-- ‚ë† Images -->
  <div class="acc-section open" id="sec-1">
    <div class="acc-header" onclick="toggleAcc('sec-1')">
      <span class="num done" id="num-1">1</span>
      <span data-i18n="sec1_title"></span>
      <span class="acc-chevron">‚ñ∂</span>
    </div>
    <div class="acc-body">
      <div class="dropzone" id="front-dz">
        <input type="file" id="front-input" accept="image/*" multiple>
        <div style="font-size:1.6rem">üñºÔ∏è</div>
        <p data-i18n-html="dropzone_text"></p>
      </div>
      <div class="thumb-grid" id="thumb-grid"></div>
      <div class="counter-bar" id="counter-bar" style="display:none">
        <span id="img-count">0</span> <span data-i18n="counter_imgs"></span> ‚Üí <span id="card-count">0</span> <span data-i18n="counter_cards"></span>
      </div>
    </div>
  </div>

  <!-- ‚ë° Back side -->
  <div class="acc-section open" id="sec-2">
    <div class="acc-header" onclick="toggleAcc('sec-2')">
      <span class="num" id="num-2">2</span>
      <span data-i18n="sec2_title"></span>
      <span class="acc-chevron">‚ñ∂</span>
    </div>
    <div class="acc-body">
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('preset')" data-i18n="tab_preset"></button>
        <button class="tab-btn" onclick="switchTab('custom')" data-i18n="tab_custom"></button>
      </div>
      <div class="tab-content active" id="tab-preset">
        <div class="swatch-grid" id="swatch-grid"></div>
      </div>
      <div class="tab-content" id="tab-custom">
        <div class="back-dz" id="back-dz">
          <input type="file" id="back-input" accept="image/*">
          <div style="font-size:1.4rem">üé®</div>
          <p style="font-size:0.78rem;color:#888;margin-top:0.25rem" data-i18n="back_upload_hint"></p>
        </div>
        <img id="back-preview" class="back-preview" alt="preview">
        <div id="back-remove-btn" style="display:none;text-align:center;margin-top:0.3rem">
          <button onclick="removeBackImage()" style="font-size:0.76rem;color:var(--red);border:none;background:none;cursor:pointer;font-weight:600" data-i18n="back_remove"></button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ë¢ Layout -->
  <div class="acc-section open" id="sec-3">
    <div class="acc-header" onclick="toggleAcc('sec-3')">
      <span class="num" id="num-3">3</span>
      <span data-i18n="sec3_title"></span>
      <span class="acc-chevron">‚ñ∂</span>
    </div>
    <div class="acc-body">
      <div class="field">
        <label data-i18n="field_title"></label>
        <input type="text" id="game-title" data-i18n-placeholder="default_title">
      </div>
      <div class="field">
        <label data-i18n="field_cols"></label>
        <select id="cols-select">
          <option value="3" data-i18n="col_3"></option>
          <option value="4" selected data-i18n="col_4"></option>
          <option value="5" data-i18n="col_5"></option>
          <option value="6" data-i18n="col_6"></option>
        </select>
      </div>
      <div class="field">
        <label><span data-i18n="field_size"></span><span class="val" id="size-val">110 px</span></label>
        <input type="range" id="size-select" min="70" max="250" value="110" step="5" oninput="onSlider(this,'size-val','px');updatePreview()">
      </div>

      <div class="field">
        <label data-i18n="field_pdf_orient"></label>
        <div class="btn-group" id="orient-group" style="grid-template-columns:1fr 1fr;margin-top:0.3rem">
          <button class="icon-btn active" data-val="portrait" onclick="setOrient(this)">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none">
              <rect x="5" y="2" width="12" height="18" rx="2" stroke="#333" stroke-width="1.8"/>
              <line x1="7.5" y1="7" x2="14.5" y2="7" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
              <line x1="7.5" y1="10" x2="14.5" y2="10" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
              <line x1="7.5" y1="13" x2="11.5" y2="13" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
            <span data-i18n="orient_portrait"></span>
          </button>
          <button class="icon-btn" data-val="landscape" onclick="setOrient(this)">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none">
              <rect x="2" y="5" width="18" height="12" rx="2" stroke="#333" stroke-width="1.8"/>
              <line x1="6" y1="8.5" x2="16" y2="8.5" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
              <line x1="6" y1="11" x2="16" y2="11" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
              <line x1="6" y1="13.5" x2="11" y2="13.5" stroke="#333" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
            <span data-i18n="orient_landscape"></span>
          </button>
        </div>
      </div>

    </div><!-- end acc-body sec-3 -->
  </div><!-- end acc-section sec-3 -->

  <!-- ‚ë£ Card style -->
  <div class="acc-section open" id="sec-4">
    <div class="acc-header" onclick="toggleAcc('sec-4')">
      <span class="num" id="num-4">4</span>
      <span data-i18n="sec4_title"></span>
      <span class="acc-chevron">‚ñ∂</span>
    </div>
    <div class="acc-body">
      <div class="card-preview-wrap">
        <div class="card-preview-label" data-i18n="preview_label"></div>
        <div class="card-preview-box">
          <div id="card-mini"><div id="card-mini-inner">üé¥</div></div>
        </div>
      </div>

      <div class="field" style="margin-bottom:0.5rem">
        <label data-i18n="field_border_style"></label>
        <div class="btn-group" id="border-style-group" style="margin-top:0.3rem">
          <button class="icon-btn active" data-val="none" onclick="setBorderStyle(this)">
            <svg width="24" height="24"><rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="#ccc" stroke-width="1.5" stroke-dasharray="2 2"/></svg>
            <span data-i18n="bs_none"></span>
          </button>
          <button class="icon-btn" data-val="solid" onclick="setBorderStyle(this)">
            <svg width="24" height="24"><rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="#333" stroke-width="2"/></svg>
            <span data-i18n="bs_solid"></span>
          </button>
          <button class="icon-btn" data-val="dashed" onclick="setBorderStyle(this)">
            <svg width="24" height="24"><rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="#333" stroke-width="2" stroke-dasharray="4 2"/></svg>
            <span data-i18n="bs_dashed"></span>
          </button>
          <button class="icon-btn" data-val="hatched" onclick="setBorderStyle(this)">
            <svg width="24" height="24"><rect x="4" y="4" width="16" height="16" rx="2" fill="none" stroke="#333" stroke-width="1.5"/><line x1="4" y1="14" x2="14" y2="4" stroke="#333" stroke-width="1"/><line x1="10" y1="20" x2="20" y2="10" stroke="#333" stroke-width="1"/></svg>
            <span data-i18n="bs_hatched"></span>
          </button>
        </div>
      </div>

      <div class="field" id="border-thickness-field">
        <label><span data-i18n="field_border_w"></span><span class="val" id="border-w-val">2 px</span></label>
        <input type="range" id="border-w" min="1" max="12" value="2" step="1" oninput="onSlider(this,'border-w-val','px');updatePreview()">
      </div>
      <div class="color-row" id="border-color-field">
        <label data-i18n="field_border_color"></label>
        <input type="color" id="border-color" value="#222222" oninput="updatePreview()">
      </div>

      <div class="divider" style="margin-bottom:0.7rem"></div>

      <div class="field">
        <label><span data-i18n="field_inner_pad"></span><span class="val" id="inner-pad-val">4 px</span></label>
        <input type="range" id="inner-pad" min="0" max="24" value="4" step="1" oninput="onSlider(this,'inner-pad-val','px');updatePreview()">
      </div>
      <div class="field">
        <label><span data-i18n="field_outer_mar"></span><span class="val" id="outer-mar-val">4 px</span></label>
        <input type="range" id="outer-mar" min="0" max="20" value="4" step="1" oninput="onSlider(this,'outer-mar-val','px');updatePreview()">
      </div>
      <div class="field">
        <label><span data-i18n="field_gap"></span><span class="val" id="gap-val">0 px</span></label>
        <input type="range" id="card-gap" min="0" max="30" value="0" step="1" oninput="onSlider(this,'gap-val','px');updatePreview()">
      </div>
      <div class="field">
        <label><span data-i18n="field_sheet_pad"></span><span class="val" id="sheet-pad-val">0 px</span></label>
        <input type="range" id="sheet-pad" min="0" max="50" value="0" step="2" oninput="onSlider(this,'sheet-pad-val','px')">
      </div>

      <div class="divider" style="margin-bottom:0.7rem"></div>

      <div class="toggle-row">
        <span class="toggle-label" data-i18n="toggle_radius"></span>
        <button class="toggle" id="radius-toggle" onclick="toggleRadius()"></button>
      </div>
      <div class="field" id="radius-field" style="display:none">
        <label><span data-i18n="field_radius"></span><span class="val" id="radius-val">10 px</span></label>
        <input type="range" id="border-radius" min="2" max="50" value="10" step="1" oninput="onSlider(this,'radius-val','px');updatePreview()">
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="btn-row">
    <button class="btn btn-generate" onclick="generate()" data-i18n="btn_generate"></button>
    <button class="btn btn-print" onclick="doPrint()" data-i18n="btn_print"></button>
    <button class="btn btn-clear" onclick="clearAll()" data-i18n="btn_clear"></button>
  </div>


  <div class="sidebar-release">
    <span class="sidebar-release-label">Version</span>
    <span class="header-version">release v1.0</span>
  </div>


</div><!-- end sidebar -->

<div class="main" id="main">
  <div class="empty-state" id="empty-state">
    <div class="big">‚úÇÔ∏è</div>
    <h2 data-i18n="empty_h"></h2>
    <p data-i18n-html="empty_p"></p>
  </div>
  <div class="sheets-wrapper" id="sheets-wrapper" style="display:none"></div>
</div>
</div><!-- end .app -->

<!-- MOBILE ACTION BAR (visible only on mobile) -->
<div class="mobile-actions" id="mobile-actions">
  <button class="btn btn-generate" onclick="generate();closeSidebar()" data-i18n="btn_generate"></button>
  <button class="btn btn-print" onclick="doPrint()" data-i18n="btn_print"></button>
</div>

<div class="toast" id="toast"></div>

<!-- WARNING MODAL -->

<!-- STARTUP / TERMS MODAL -->
<div class="start-overlay" id="start-overlay" aria-hidden="true">
  <div class="start-box" role="dialog" aria-modal="true" aria-labelledby="start-title">
    <div class="start-badge">üéÅ</div>
    <h2 id="start-title" tabindex="-1" data-i18n="start_title"></h2>
    <p class="start-lead" data-i18n="start_free"></p>

    <div class="start-terms">
      <h3 data-i18n="start_terms_title"></h3>
      <ul>
        <li data-i18n="start_terms_1"></li>
        <li data-i18n="start_terms_2"></li>
        <li data-i18n="start_terms_3"></li>
      </ul>
      <div class="muted" data-i18n="start_terms_note"></div>
    </div>

    <label class="start-check">
      <input type="checkbox" id="start-accept">
      <span data-i18n="start_accept_label"></span>
    </label>

    <div class="start-actions">
      <button class="btn btn-ghost" id="start-support-btn" type="button" data-i18n="start_support_btn"></button>
      <button class="btn btn-primary" id="start-continue-btn" type="button" disabled data-i18n="start_continue_btn"></button>
    </div>

    <div class="start-support" id="start-support">
      <p data-i18n="start_support_note"></p>
      <a id="start-support-link" href="#" target="_blank" rel="noopener" data-i18n="start_support_link"></a>
    </div>
  </div>
</div>

<div class="warn-overlay" id="warn-overlay">
  <div class="warn-box">
    <div class="warn-icon">‚ö†Ô∏è</div>
    <h3 data-i18n="warn_title"></h3>
    <p id="warn-body-text"></p>
    <div class="warn-actions">
      <button class="btn btn-warn-cancel" onclick="closeWarn()" data-i18n="warn_cancel"></button>
      <button class="btn btn-warn-proceed" onclick="confirmGenerate()" data-i18n="warn_proceed"></button>
    </div>
  </div>
</div>

<!-- PDF OVERLAY -->
<div class="pdf-overlay" id="pdf-overlay">
  <div class="pdf-overlay-box">
    <div class="pdf-icon">üìÑ</div>
    <h3 data-i18n="pdf_title"></h3>
    <div class="pdf-sub" id="pdf-sub"></div>
    <div class="pdf-progress-track">
      <div class="pdf-progress-fill" id="pdf-progress-fill"></div>
    </div>
    <div class="pdf-progress-label" id="pdf-progress-label">0 %</div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TRANSLATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const LANGS = {
  cs: {
    header_sub:       'max. 64 p√°r≈Ø ¬∑ 128 karet ¬∑ tisk A4',
    
    // Startup modal
    start_title: 'Ne≈æ zaƒçne≈°‚Ä¶',
    start_free: 'Tato aplikace je plnƒõ zdarma. Pou≈æ√≠v√°n√≠m potvrzuje≈° podm√≠nky pou≈æit√≠ n√≠≈æe.',
    start_terms_title: 'Podm√≠nky pou≈æit√≠',
    start_terms_1: 'Aplikace je poskytov√°na ‚Äûtak jak je‚Äú (bez z√°ruk). Pou≈æ√≠v√°≈° ji na vlastn√≠ odpovƒõdnost.',
    start_terms_2: 'Nahran√© obr√°zky se zpracov√°vaj√≠ lok√°lnƒõ ve tv√©m prohl√≠≈æeƒçi (neodes√≠laj√≠ se na server).',
    start_terms_3: 'Podpora je dobrovoln√° ‚Äì m≈Ø≈æe≈° zaslat libovolnou ƒç√°stku jako podƒõkov√°n√≠.',
    start_terms_note: 'Tip: odkaz/√∫daje pro podporu si nastav√≠≈° v k√≥du v promƒõnn√© SUPPORT_URL.',
    start_accept_label: 'Souhlas√≠m s podm√≠nkami pou≈æit√≠.',
    start_support_btn: 'Chci podpo≈ôit',
    start_continue_btn: 'Souhlas√≠m a pokraƒçovat',
    start_support_note: 'D√≠ky! Podporu m≈Ø≈æe≈° poslat p≈ôes odkaz n√≠≈æe (dopl≈à si sv≈Øj PayPal/Ko‚Äëfi/bankovn√≠ √∫daje).',
    start_support_link: 'Otev≈ô√≠t odkaz pro podporu',
sec1_title:       'Obr√°zky',
    dropzone_text:    'P≈ôet√°hnƒõte nebo <strong>kliknƒõte</strong><br>max. 64 obr√°zk≈Ø = 128 karet',
    counter_imgs:     'obr.',
    counter_cards:    'karet',
    sec2_title:       'Rubov√° strana',
    tab_preset:       'Vzor',
    tab_custom:       'Vlastn√≠ obr√°zek',
    back_upload_hint: 'Nahrajte obr√°zek rubov√© strany',
    back_remove:      '‚úï Odebrat',
    sec3_title:       'Rozlo≈æen√≠',
    field_title:      'N√°zev hry',
    default_title:    'Moje Pexeso',
    field_cols:       'Poƒçet sloupc≈Ø',
    col_3: '3 sloupce', col_4: '4 sloupce', col_5: '5 sloupc≈Ø', col_6: '6 sloupc≈Ø',
    field_size:       'Velikost karet',
    field_pdf_orient: 'Orientace PDF',
    orient_portrait:  'Na v√Ω≈°ku',
    orient_landscape: 'Na ≈°√≠≈ôku',
    sec4_title:       'Styl karet',
    preview_label:    'N√°hled karty',
    field_border_style: 'Styl okraje',
    bs_none: '≈Ω√°dn√Ω', bs_solid: 'Pln√Ω', bs_dashed: 'ƒå√°rk.', bs_hatched: '≈†raf.',
    field_border_w:   'Tlou≈°≈•ka okraje',
    field_border_color: 'Barva okraje',
    field_inner_pad:  'Vnit≈ôn√≠ odsazen√≠',
    field_outer_mar:  'Vnƒõj≈°√≠ odsazen√≠',
    field_gap:        'Mezera mezi kartami',
    field_sheet_pad:  'Odsazen√≠ listu od okraje',
    toggle_radius:    'Zaoblen√≠ roh≈Ø',
    field_radius:     'Polomƒõr zaoblen√≠',
    btn_generate:     '‚úÇ Vygenerovat pexeso',
    btn_pdf:          '‚¨á Ulo≈æit jako PDF',
    btn_print:        'üñ® Vytisknout',
    btn_clear:        'üóë Vymazat v≈°e',
    empty_h:          'P≈ôipraveno ke st≈ôih√°n√≠!',
    empty_p:          'Nahrajte obr√°zky vlevo a kliknƒõte na <strong>Vygenerovat pexeso</strong>',
    warn_title:       'Hodnƒõ karet!',
    warn_body:        'Generujete v√≠ce ne≈æ <strong>32 p√°r≈Ø ({pairs} p√°r≈Ø, {cards} karet)</strong>.<br><br>Tisk m≈Ø≈æe trvat d√©le a v√Ωsledn√© PDF bude velk√Ω soubor.',
    warn_cancel:      'Zru≈°it',
    warn_proceed:     '‚ö° Pokraƒçovat',
    pdf_title:        'Generuji PDF‚Ä¶',
    pdf_init:         'Inicializuji‚Ä¶',
    pdf_preparing:    'P≈ôipravuji listy‚Ä¶',
    pdf_processing:   'Zpracov√°v√°m list {i} / {total}‚Ä¶',
    pdf_saving:       'Ukl√°d√°m soubor‚Ä¶',
    pdf_done:         'Hotovo! ‚úì',
    sheet_front:      'P≈òEDN√ç STRANA',
    sheet_back:       'RUBOV√Å STRANA',
    page_of: 'Strana {p}/{t}',
    sheet_list1:      'List 1',
    sheet_list2:      'List 2',
    sheet_info_front: '{n} karet ¬∑ {r} √ó {c}',
    sheet_info_back:  '{n} karet ¬∑ zrcadleno',
    note_front:       '<strong>üí° Tip:</strong> Tisknƒõte na pevnƒõj≈°√≠ pap√≠r (120‚Äì200 g/m¬≤). St≈ô√≠hejte pod√©l p≈ôeru≈°ovan√Ωch ƒçar. Toto je <strong>strana 1</strong> (p≈ôedn√≠).',
    note_back:        '<strong>üñ®Ô∏è Oboustrann√Ω tisk:</strong> Vlo≈æte list 1 zpƒõt do tisk√°rny a tisknƒõte tuto stranu. Rubov√° strana je <strong>zrcadlena</strong> pro p≈ôesn√© p≈ôekryt√≠.<br><strong>Jednostrann√Ω tisk:</strong> Vyst≈ôihnƒõte a slepte karty k sobƒõ.',
    pdf_label_front:  'Strana {n} ‚Äî P≈òEDN√ç',
    pdf_label_back:   'Strana {n} ‚Äî RUBOV√Å',
    toast_no_images:  'Nejprve nahrajte obr√°zky! üñºÔ∏è',
    toast_no_back:    'Nahrajte rubov√Ω obr√°zek nebo zvolte vzor',
    toast_max:        'Max 64 obr√°zk≈Ø!',
    toast_added:      'P≈ôid√°no {n} obr√°zk≈Ø ‚úì',
    toast_generated:  'Pexeso vygenerov√°no! {n} p√°r≈Ø ‚úÇÔ∏è',
    toast_cleared:    'Vymaz√°no üóë',
    toast_print_first:'Nejprve vygenerujte pexeso!',
    toast_pdf_saved:  'PDF ulo≈æeno! üéâ',
    toast_pdf_error:  'Chyba p≈ôi generov√°n√≠ PDF.',
    toast_back_ok:    'Rubov√Ω obr√°zek nahr√°n ‚úì',
    pat_rainbow: 'Duhov√Ω', pat_blue: 'Modr√Ω', pat_red: 'ƒåerven√Ω', pat_green: 'Zelen√Ω',
    pat_stars: 'Hvƒõzdy', pat_dots: 'Teƒçky', pat_stripes: 'Pruhy', pat_dark: 'Tmav√Ω', pat_pink: 'R≈Ø≈æov√Ω',
  },
  en: {
    header_sub:       'max. 64 pairs ¬∑ 128 cards ¬∑ A4 print',
    
    // Startup modal
    start_title: 'Before you start‚Ä¶',
    start_free: 'This app is completely free. By continuing, you confirm the terms of use below.',
    start_terms_title: 'Terms of use',
    start_terms_1: 'The app is provided ‚Äúas is‚Äù (no warranties). You use it at your own risk.',
    start_terms_2: 'Uploaded images are processed locally in your browser (not uploaded to a server).',
    start_terms_3: 'Support is optional ‚Äî you can send any amount as a thank‚Äëyou.',
    start_terms_note: 'Tip: set your support link/details in the code via the SUPPORT_URL variable.',
    start_accept_label: 'I agree to the terms of use.',
    start_support_btn: 'Support',
    start_continue_btn: 'Agree & continue',
    start_support_note: 'Thank you! You can support via the link below (set your PayPal/Ko‚Äëfi/bank details).',
    start_support_link: 'Open support link',
sec1_title:       'Images',
    dropzone_text:    'Drag & drop or <strong>click to browse</strong><br>max. 64 images = 128 cards',
    counter_imgs:     'imgs.',
    counter_cards:    'cards',
    sec2_title:       'Card back',
    tab_preset:       'Pattern',
    tab_custom:       'Custom image',
    back_upload_hint: 'Upload a back-side image',
    back_remove:      '‚úï Remove',
    sec3_title:       'Layout',
    field_title:      'Game title',
    default_title:    'My Memory Game',
    field_cols:       'Columns',
    col_3: '3 columns', col_4: '4 columns', col_5: '5 columns', col_6: '6 columns',
    field_size:       'Card size',
    field_pdf_orient: 'PDF orientation',
    orient_portrait:  'Portrait',
    orient_landscape: 'Landscape',
    sec4_title:       'Card style',
    preview_label:    'Card preview',
    field_border_style: 'Border style',
    bs_none: 'None', bs_solid: 'Solid', bs_dashed: 'Dashed', bs_hatched: 'Hatched',
    field_border_w:   'Border width',
    field_border_color: 'Border color',
    field_inner_pad:  'Inner padding',
    field_outer_mar:  'Outer margin',
    field_gap:        'Gap between cards',
    field_sheet_pad:  'Sheet margin',
    toggle_radius:    'Rounded corners',
    field_radius:     'Corner radius',
    btn_generate:     '‚úÇ Generate cards',
    btn_pdf:          '‚¨á Save as PDF',
    btn_print:        'üñ® Print',
    btn_clear:        'üóë Clear all',
    empty_h:          'Ready to cut!',
    empty_p:          'Upload images on the left and click <strong>Generate cards</strong>',
    warn_title:       'Lots of cards!',
    warn_body:        'You are generating more than <strong>32 pairs ({pairs} pairs, {cards} cards)</strong>.<br><br>Printing may take longer and the PDF will be large.',
    warn_cancel:      'Cancel',
    warn_proceed:     '‚ö° Continue',
    pdf_title:        'Generating PDF‚Ä¶',
    pdf_init:         'Initialising‚Ä¶',
    pdf_preparing:    'Preparing sheets‚Ä¶',
    pdf_processing:   'Processing sheet {i} / {total}‚Ä¶',
    pdf_saving:       'Saving file‚Ä¶',
    pdf_done:         'Done! ‚úì',
    sheet_front:      'FRONT SIDE',
    sheet_back:       'BACK SIDE',
    page_of: 'Page {p}/{t}',
    sheet_list1:      'Sheet 1',
    sheet_list2:      'Sheet 2',
    sheet_info_front: '{n} cards ¬∑ {r} √ó {c}',
    sheet_info_back:  '{n} cards ¬∑ mirrored',
    note_front:       '<strong>üí° Tip:</strong> Print on heavier paper (120‚Äì200 g/m¬≤). Cut along the dashed lines. This is <strong>sheet 1</strong> (front).',
    note_back:        '<strong>üñ®Ô∏è Duplex printing:</strong> Reload sheet 1 into the printer and print this side. The back is <strong>mirrored</strong> for perfect alignment.<br><strong>Single-sided:</strong> Cut out and glue front and back together.',
    pdf_label_front:  'Sheet {n} ‚Äî FRONT',
    pdf_label_back:   'Sheet {n} ‚Äî BACK',
    toast_no_images:  'Please upload images first! üñºÔ∏è',
    toast_no_back:    'Upload a back image or choose a pattern',
    toast_max:        'Max 64 images!',
    toast_added:      '{n} images added ‚úì',
    toast_generated:  'Cards generated! {n} pairs ‚úÇÔ∏è',
    toast_cleared:    'Cleared üóë',
    toast_print_first:'Generate cards first!',
    toast_pdf_saved:  'PDF saved! üéâ',
    toast_pdf_error:  'Error generating PDF.',
    toast_back_ok:    'Back image uploaded ‚úì',
    pat_rainbow: 'Rainbow', pat_blue: 'Blue', pat_red: 'Red', pat_green: 'Green',
    pat_stars: 'Stars', pat_dots: 'Dots', pat_stripes: 'Stripes', pat_dark: 'Dark', pat_pink: 'Pink',
  },
  sk: {
    header_sub:       'max. 64 p√°rov ¬∑ 128 kariet ¬∑ tlaƒç A4',
    
    // Startup modal
    start_title: 'Sk√¥r ne≈æ zaƒçne≈°‚Ä¶',
    start_free: 'T√°to aplik√°cia je √∫plne zadarmo. Pokraƒçovan√≠m potvrdzuje≈° podmienky pou≈æ√≠vania ni≈æ≈°ie.',
    start_terms_title: 'Podmienky pou≈æ√≠vania',
    start_terms_1: 'Aplik√°cia je poskytovan√° ‚Äûtak ako je‚Äú (bez z√°ruk). Pou≈æ√≠va≈° ju na vlastn√© riziko.',
    start_terms_2: 'Nahran√© obr√°zky sa sprac√∫vaj√∫ lok√°lne v tvojom prehliadaƒçi (neodosielaj√∫ sa na server).',
    start_terms_3: 'Podpora je dobrovoƒæn√° ‚Äì m√¥≈æe≈° posla≈• ƒæubovoƒæn√∫ sumu ako poƒèakovanie.',
    start_terms_note: 'Tip: odkaz/√∫daje pre podporu nastav√≠≈° v k√≥de v premennej SUPPORT_URL.',
    start_accept_label: 'S√∫hlas√≠m s podmienkami pou≈æ√≠vania.',
    start_support_btn: 'Chcem podpori≈•',
    start_continue_btn: 'S√∫hlas√≠m a pokraƒçova≈•',
    start_support_note: 'Vƒèaka! Podporu m√¥≈æe≈° posla≈• cez odkaz ni≈æ≈°ie (dopl≈à si PayPal/Ko‚Äëfi/bankov√© √∫daje).',
    start_support_link: 'Otvori≈• odkaz na podporu',
sec1_title:       'Obr√°zky',
    dropzone_text:    'Potiahnite alebo <strong>kliknite</strong><br>max. 64 obr√°zkov = 128 kariet',
    counter_imgs:     'obr.',
    counter_cards:    'kariet',
    sec2_title:       'Rub karty',
    tab_preset:       'Vzor',
    tab_custom:       'Vlastn√Ω obr√°zok',
    back_upload_hint: 'Nahrajte obr√°zok rubu karty',
    back_remove:      '‚úï Odstr√°ni≈•',
    sec3_title:       'Rozlo≈æenie',
    field_title:      'N√°zov hry',
    default_title:    'Moje Pexeso',
    field_cols:       'Poƒçet stƒ∫pcov',
    col_3: '3 stƒ∫pce', col_4: '4 stƒ∫pce', col_5: '5 stƒ∫pcov', col_6: '6 stƒ∫pcov',
    field_size:       'Veƒækos≈• kariet',
    field_pdf_orient: 'Orient√°cia PDF',
    orient_portrait:  'Na v√Ω≈°ku',
    orient_landscape: 'Na ≈°√≠rku',
    sec4_title:       '≈†t√Ωl kariet',
    preview_label:    'N√°hƒæad karty',
    field_border_style: '≈†t√Ωl okraja',
    bs_none: '≈Ωiadny', bs_solid: 'Pln√Ω', bs_dashed: 'ƒåiarkov.', bs_hatched: '≈†rafov.',
    field_border_w:   'Hr√∫bka okraja',
    field_border_color: 'Farba okraja',
    field_inner_pad:  'Vn√∫torn√© odsadenie',
    field_outer_mar:  'Vonkaj≈°ie odsadenie',
    field_gap:        'Medzera medzi kartami',
    field_sheet_pad:  'Odsadenie listu od okraja',
    toggle_radius:    'Zaoblenie rohov',
    field_radius:     'Polomer zaoblenia',
    btn_generate:     '‚úÇ Vygenerova≈• pexeso',
    btn_pdf:          '‚¨á Ulo≈æi≈• ako PDF',
    btn_print:        'üñ® Tlaƒçi≈•',
    btn_clear:        'üóë Vymaza≈• v≈°etko',
    empty_h:          'Pripraven√© na strihanie!',
    empty_p:          'Nahrajte obr√°zky vƒæavo a kliknite na <strong>Vygenerova≈• pexeso</strong>',
    warn_title:       'Veƒæa kariet!',
    warn_body:        'Generujete viac ako <strong>32 p√°rov ({pairs} p√°rov, {cards} kariet)</strong>.<br><br>Tlaƒç m√¥≈æe trva≈• dlh≈°ie a PDF bude veƒæk√Ω s√∫bor.',
    warn_cancel:      'Zru≈°i≈•',
    warn_proceed:     '‚ö° Pokraƒçova≈•',
    pdf_title:        'Generujem PDF‚Ä¶',
    pdf_init:         'Inicializujem‚Ä¶',
    pdf_preparing:    'Pripravujem listy‚Ä¶',
    pdf_processing:   'Spracov√°vam list {i} / {total}‚Ä¶',
    pdf_saving:       'Uklad√°m s√∫bor‚Ä¶',
    pdf_done:         'Hotovo! ‚úì',
    sheet_front:      'PREDN√Å STRANA',
    sheet_back:       'RUBOV√Å STRANA',
    page_of: 'Strana {p}/{t}',
    sheet_list1:      'List 1',
    sheet_list2:      'List 2',
    sheet_info_front: '{n} kariet ¬∑ {r} √ó {c}',
    sheet_info_back:  '{n} kariet ¬∑ zrkadlen√©',
    note_front:       '<strong>üí° Tip:</strong> Tlaƒçte na pevnej≈°√≠ papier (120‚Äì200 g/m¬≤). Strihajte pozdƒ∫≈æ preru≈°ovan√Ωch ƒçiar. Toto je <strong>strana 1</strong> (predn√°).',
    note_back:        '<strong>üñ®Ô∏è Obojstrann√° tlaƒç:</strong> Vlo≈æte list 1 sp√§≈• do tlaƒçiarne a tlaƒçte t√∫to stranu. Rub je <strong>zrkadlen√Ω</strong> pre presn√© prekrytie.<br><strong>Jednostrann√° tlaƒç:</strong> Vystrihnite a zlepte karty.',
    pdf_label_front:  'Strana {n} ‚Äî PREDN√Å',
    pdf_label_back:   'Strana {n} ‚Äî RUBOV√Å',
    toast_no_images:  'Najprv nahrajte obr√°zky! üñºÔ∏è',
    toast_no_back:    'Nahrajte obr√°zok rubu alebo zvoƒæte vzor',
    toast_max:        'Max 64 obr√°zkov!',
    toast_added:      'Pridan√Ωch {n} obr√°zkov ‚úì',
    toast_generated:  'Pexeso vygenerovan√©! {n} p√°rov ‚úÇÔ∏è',
    toast_cleared:    'Vymazan√© üóë',
    toast_print_first:'Najprv vygenerujte pexeso!',
    toast_pdf_saved:  'PDF ulo≈æen√©! üéâ',
    toast_pdf_error:  'Chyba pri generovan√≠ PDF.',
    toast_back_ok:    'Obr√°zok rubu nahran√Ω ‚úì',
    pat_rainbow: 'D√∫hov√Ω', pat_blue: 'Modr√Ω', pat_red: 'ƒåerven√Ω', pat_green: 'Zelen√Ω',
    pat_stars: 'Hviezdy', pat_dots: 'Bodky', pat_stripes: 'Pruhy', pat_dark: 'Tmav√Ω', pat_pink: 'Ru≈æov√Ω',
  },
  pl: {
    header_sub:       'maks. 64 pary ¬∑ 128 kart ¬∑ druk A4',
    
    // Startup modal
    start_title: 'Zanim zaczniesz‚Ä¶',
    start_free: 'Ta aplikacja jest w pe≈Çni darmowa. KontynuujƒÖc, potwierdzasz poni≈ºsze warunki.',
    start_terms_title: 'Warunki korzystania',
    start_terms_1: 'Aplikacja jest dostarczana ‚Äûtak jak jest‚Äù (bez gwarancji). U≈ºywasz jej na w≈Çasne ryzyko.',
    start_terms_2: 'Wgrane obrazy sƒÖ przetwarzane lokalnie w przeglƒÖdarce (nie sƒÖ wysy≈Çane na serwer).',
    start_terms_3: 'Wsparcie jest dobrowolne ‚Äî mo≈ºesz wys≈Çaƒá dowolnƒÖ kwotƒô jako podziƒôkowanie.',
    start_terms_note: 'Wskaz√≥wka: ustaw link/dane wsparcia w kodzie w zmiennej SUPPORT_URL.',
    start_accept_label: 'Akceptujƒô warunki korzystania.',
    start_support_btn: 'Chcƒô wesprzeƒá',
    start_continue_btn: 'Akceptujƒô i kontynuujƒô',
    start_support_note: 'Dziƒôkujƒô! Mo≈ºesz wesprzeƒá przez link poni≈ºej (ustaw PayPal/Ko‚Äëfi/dane bankowe).',
    start_support_link: 'Otw√≥rz link wsparcia',
sec1_title:       'Obrazki',
    dropzone_text:    'PrzeciƒÖgnij lub <strong>kliknij</strong><br>maks. 64 obrazki = 128 kart',
    counter_imgs:     'obr.',
    counter_cards:    'kart',
    sec2_title:       'Rewers karty',
    tab_preset:       'Wz√≥r',
    tab_custom:       'W≈Çasny obraz',
    back_upload_hint: 'Prze≈õlij obraz rewersu karty',
    back_remove:      '‚úï Usu≈Ñ',
    sec3_title:       'Uk≈Çad',
    field_title:      'Nazwa gry',
    default_title:    'Moje Memory',
    field_cols:       'Liczba kolumn',
    col_3: '3 kolumny', col_4: '4 kolumny', col_5: '5 kolumn', col_6: '6 kolumn',
    field_size:       'Rozmiar kart',
    field_pdf_orient: 'Orientacja PDF',
    orient_portrait:  'Pionowo',
    orient_landscape: 'Poziomo',
    sec4_title:       'Styl kart',
    preview_label:    'PodglƒÖd karty',
    field_border_style: 'Styl obramowania',
    bs_none: 'Brak', bs_solid: 'Pe≈Çne', bs_dashed: 'Przeryw.', bs_hatched: 'Kreskov.',
    field_border_w:   'Grubo≈õƒá ramki',
    field_border_color: 'Kolor ramki',
    field_inner_pad:  'Wewnƒôtrzny margines',
    field_outer_mar:  'Zewnƒôtrzny margines',
    field_gap:        'Odstƒôp miƒôdzy kartami',
    field_sheet_pad:  'Margines arkusza',
    toggle_radius:    'ZaokrƒÖglone rogi',
    field_radius:     'Promie≈Ñ zaokrƒÖglenia',
    btn_generate:     '‚úÇ Wygeneruj karty',
    btn_pdf:          '‚¨á Zapisz jako PDF',
    btn_print:        'üñ® Drukuj',
    btn_clear:        'üóë Wyczy≈õƒá wszystko',
    empty_h:          'Gotowe do ciƒôcia!',
    empty_p:          'Prze≈õlij obrazki po lewej i kliknij <strong>Wygeneruj karty</strong>',
    warn_title:       'Du≈ºo kart!',
    warn_body:        'Generujesz wiƒôcej ni≈º <strong>32 pary ({pairs} par, {cards} kart)</strong>.<br><br>Drukowanie mo≈ºe potrwaƒá d≈Çu≈ºej, a PDF bƒôdzie du≈ºy.',
    warn_cancel:      'Anuluj',
    warn_proceed:     '‚ö° Kontynuuj',
    pdf_title:        'Generujƒô PDF‚Ä¶',
    pdf_init:         'Inicjalizujƒô‚Ä¶',
    pdf_preparing:    'Przygotowujƒô arkusze‚Ä¶',
    pdf_processing:   'Przetwarzam arkusz {i} / {total}‚Ä¶',
    pdf_saving:       'Zapisujƒô plik‚Ä¶',
    pdf_done:         'Gotowe! ‚úì',
    sheet_front:      'AWERS',
    sheet_back:       'REWERS',
    page_of: 'Strona {p}/{t}',
    sheet_list1:      'Arkusz 1',
    sheet_list2:      'Arkusz 2',
    sheet_info_front: '{n} kart ¬∑ {r} √ó {c}',
    sheet_info_back:  '{n} kart ¬∑ lustrzane',
    note_front:       '<strong>üí° Wskaz√≥wka:</strong> Drukuj na grubszym papierze (120‚Äì200 g/m¬≤). Wycinaj wzd≈Çu≈º przerywanych linii. To jest <strong>arkusz 1</strong> (awers).',
    note_back:        '<strong>üñ®Ô∏è Druk dwustronny:</strong> W≈Ç√≥≈º arkusz 1 z powrotem do drukarki i drukuj tƒô stronƒô. Rewers jest <strong>lustrzany</strong> dla idealnego dopasowania.<br><strong>Druk jednostronny:</strong> Wytnij i sklej karty.',
    pdf_label_front:  'Strona {n} ‚Äî AWERS',
    pdf_label_back:   'Strona {n} ‚Äî REWERS',
    toast_no_images:  'Najpierw prze≈õlij obrazki! üñºÔ∏è',
    toast_no_back:    'Prze≈õlij obraz rewersu lub wybierz wz√≥r',
    toast_max:        'Maks. 64 obrazki!',
    toast_added:      'Dodano {n} obrazk√≥w ‚úì',
    toast_generated:  'Karty wygenerowane! {n} par ‚úÇÔ∏è',
    toast_cleared:    'Wyczyszczono üóë',
    toast_print_first:'Najpierw wygeneruj karty!',
    toast_pdf_saved:  'PDF zapisany! üéâ',
    toast_pdf_error:  'B≈ÇƒÖd generowania PDF.',
    toast_back_ok:    'Obraz rewersu przes≈Çany ‚úì',
    pat_rainbow: 'Tƒôczowy', pat_blue: 'Niebieski', pat_red: 'Czerwony', pat_green: 'Zielony',
    pat_stars: 'Gwiazdy', pat_dots: 'Kropki', pat_stripes: 'Paski', pat_dark: 'Ciemny', pat_pink: 'R√≥≈ºowy',
  },
  de: {
    header_sub:       'max. 64 Paare ¬∑ 128 Karten ¬∑ A4-Druck',
    
    // Startup modal
    start_title: 'Bevor du startest‚Ä¶',
    start_free: 'Diese App ist komplett kostenlos. Wenn du fortf√§hrst, best√§tigst du die Nutzungsbedingungen unten.',
    start_terms_title: 'Nutzungsbedingungen',
    start_terms_1: 'Die App wird ‚Äûwie sie ist‚Äú bereitgestellt (ohne Gew√§hr). Nutzung auf eigenes Risiko.',
    start_terms_2: 'Hochgeladene Bilder werden lokal im Browser verarbeitet (nicht auf einen Server hochgeladen).',
    start_terms_3: 'Unterst√ºtzung ist freiwillig ‚Äî du kannst einen beliebigen Betrag als Dank senden.',
    start_terms_note: 'Tipp: Support‚ÄëLink/Details im Code √ºber die Variable SUPPORT_URL setzen.',
    start_accept_label: 'Ich stimme den Nutzungsbedingungen zu.',
    start_support_btn: 'Unterst√ºtzen',
    start_continue_btn: 'Zustimmen & weiter',
    start_support_note: 'Danke! Unterst√ºtzung √ºber den Link unten (PayPal/Ko‚Äëfi/Bankdaten eintragen).',
    start_support_link: 'Support‚ÄëLink √∂ffnen',
sec1_title:       'Bilder',
    dropzone_text:    'Ziehen oder <strong>klicken</strong><br>max. 64 Bilder = 128 Karten',
    counter_imgs:     'Bilder',
    counter_cards:    'Karten',
    sec2_title:       'Kartenr√ºckseite',
    tab_preset:       'Muster',
    tab_custom:       'Eigenes Bild',
    back_upload_hint: 'Bild f√ºr die R√ºckseite hochladen',
    back_remove:      '‚úï Entfernen',
    sec3_title:       'Layout',
    field_title:      'Spielname',
    default_title:    'Mein Memory',
    field_cols:       'Spaltenanzahl',
    col_3: '3 Spalten', col_4: '4 Spalten', col_5: '5 Spalten', col_6: '6 Spalten',
    field_size:       'Kartengr√∂√üe',
    field_pdf_orient: 'PDF-Ausrichtung',
    orient_portrait:  'Hochformat',
    orient_landscape: 'Querformat',
    sec4_title:       'Kartenstil',
    preview_label:    'Kartenvorschau',
    field_border_style: 'Rahmenstil',
    bs_none: 'Keiner', bs_solid: 'Voll', bs_dashed: 'Gestrich.', bs_hatched: 'Schraffiert',
    field_border_w:   'Rahmenbreite',
    field_border_color: 'Rahmenfarbe',
    field_inner_pad:  'Innenabstand',
    field_outer_mar:  'Au√üenabstand',
    field_gap:        'Abstand zwischen Karten',
    field_sheet_pad:  'Blattrand',
    toggle_radius:    'Abgerundete Ecken',
    field_radius:     'Eckenradius',
    btn_generate:     '‚úÇ Karten generieren',
    btn_pdf:          '‚¨á Als PDF speichern',
    btn_print:        'üñ® Drucken',
    btn_clear:        'üóë Alles l√∂schen',
    empty_h:          'Bereit zum Schneiden!',
    empty_p:          'Bilder links hochladen und auf <strong>Karten generieren</strong> klicken',
    warn_title:       'Viele Karten!',
    warn_body:        'Sie generieren mehr als <strong>32 Paare ({pairs} Paare, {cards} Karten)</strong>.<br><br>Das Drucken kann l√§nger dauern und das PDF wird gro√ü.',
    warn_cancel:      'Abbrechen',
    warn_proceed:     '‚ö° Weiter',
    pdf_title:        'PDF wird erstellt‚Ä¶',
    pdf_init:         'Initialisierung‚Ä¶',
    pdf_preparing:    'Bl√§tter werden vorbereitet‚Ä¶',
    pdf_processing:   'Blatt {i} / {total} wird verarbeitet‚Ä¶',
    pdf_saving:       'Datei wird gespeichert‚Ä¶',
    pdf_done:         'Fertig! ‚úì',
    sheet_front:      'VORDERSEITE',
    sheet_back:       'R√úCKSEITE',
    page_of: 'Seite {p}/{t}',
    sheet_list1:      'Blatt 1',
    sheet_list2:      'Blatt 2',
    sheet_info_front: '{n} Karten ¬∑ {r} √ó {c}',
    sheet_info_back:  '{n} Karten ¬∑ gespiegelt',
    note_front:       '<strong>üí° Tipp:</strong> Drucken Sie auf st√§rkerem Papier (120‚Äì200 g/m¬≤). Schneiden Sie entlang der gestrichelten Linien. Dies ist <strong>Blatt 1</strong> (Vorderseite).',
    note_back:        '<strong>üñ®Ô∏è Duplexdruck:</strong> Legen Sie Blatt 1 wieder in den Drucker und drucken Sie diese Seite. Die R√ºckseite ist <strong>gespiegelt</strong> f√ºr genaue √úbereinstimmung.<br><strong>Einseitiger Druck:</strong> Ausschneiden und zusammenkleben.',
    pdf_label_front:  'Seite {n} ‚Äî VORDER',
    pdf_label_back:   'Seite {n} ‚Äî R√úCK',
    toast_no_images:  'Bitte zuerst Bilder hochladen! üñºÔ∏è',
    toast_no_back:    'R√ºckseitenbild hochladen oder Muster w√§hlen',
    toast_max:        'Max. 64 Bilder!',
    toast_added:      '{n} Bilder hinzugef√ºgt ‚úì',
    toast_generated:  'Karten generiert! {n} Paare ‚úÇÔ∏è',
    toast_cleared:    'Geleert üóë',
    toast_print_first:'Bitte zuerst Karten generieren!',
    toast_pdf_saved:  'PDF gespeichert! üéâ',
    toast_pdf_error:  'Fehler beim Erstellen des PDFs.',
    toast_back_ok:    'R√ºckseitenbild hochgeladen ‚úì',
    pat_rainbow: 'Regenbogen', pat_blue: 'Blau', pat_red: 'Rot', pat_green: 'Gr√ºn',
    pat_stars: 'Sterne', pat_dots: 'Punkte', pat_stripes: 'Streifen', pat_dark: 'Dunkel', pat_pink: 'Rosa',
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SIDEBAR TOGGLE (mobile)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleSidebar() {
  const s = document.getElementById('sidebar');
  const o = document.getElementById('sidebar-overlay');
  const open = s.classList.toggle('open');
  o.classList.toggle('visible', open);
  document.body.style.overflow = open ? 'hidden' : '';
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebar-overlay').classList.remove('visible');
  document.body.style.overflow = '';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// I18N ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentLang = 'cs';

function t(key, vars = {}) {
  let str = (LANGS[currentLang] || LANGS.cs)[key] || key;
  Object.entries(vars).forEach(([k,v]) => { str = str.replaceAll(`{${k}}`, v); });
  return str;
}

function setLang(code) {
  currentLang = code;
  document.getElementById('html-root').lang = code;
  document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.dataset.lang === code));
  applyLang();
  // Re-render swatches (names translate)
  initSwatches();
  // Re-render column options
  document.querySelectorAll('#cols-select option[data-i18n]').forEach(o => {
    o.textContent = t(o.dataset.i18n);
  });
  // Update game-title placeholder
  document.getElementById('game-title').placeholder = t('default_title');
  // If game title is still default in any language, update it too
  localStorage.setItem('pexeso-lang', code);
}

function applyLang() {
  // data-i18n ‚Üí textContent
  document.querySelectorAll('[data-i18n]').forEach(el => {
    el.textContent = t(el.dataset.i18n);
  });
  // data-i18n-html ‚Üí innerHTML
  document.querySelectorAll('[data-i18n-html]').forEach(el => {
    el.innerHTML = t(el.dataset.i18nHtml || el.getAttribute('data-i18n-html'));
  });
  // data-i18n-placeholder ‚Üí placeholder
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    el.placeholder = t(el.getAttribute('data-i18n-placeholder'));
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let images = [];
let backMode = 'preset';
let selectedPattern = 0;
let customBackSrc = null;
let borderStyleVal = 'none';
let radiusEnabled = false;
let pdfOrient = 'portrait'; // 'portrait' | 'landscape'

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PATTERNS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const patternDefs = [
  { key: 'pat_rainbow', bg: 'linear-gradient(135deg,#f97316,#facc15,#4ade80,#38bdf8,#a78bfa)' },
  { key: 'pat_blue',    bg: 'repeating-linear-gradient(45deg,#1d4ed8 0,#1d4ed8 8px,#2563eb 8px,#2563eb 16px)' },
  { key: 'pat_red',     bg: 'linear-gradient(135deg,#b91c1c,#ef4444)' },
  { key: 'pat_green',   bg: 'linear-gradient(135deg,#065f46,#34d399)' },
  { key: 'pat_stars',   bg: '#1e1b4b', extra: 'radial-gradient(circle,rgba(255,255,255,.7) 1px,transparent 1px) 0 0/18px 18px' },
  { key: 'pat_dots',    bg: '#fff',    extra: 'radial-gradient(circle,#f97316 2px,transparent 2px) 0 0/20px 20px,radial-gradient(circle,#fbbf24 2px,transparent 2px) 10px 10px/20px 20px' },
  { key: 'pat_stripes', bg: 'repeating-linear-gradient(0deg,#fef9c3 0,#fef9c3 10px,#fde047 10px,#fde047 20px)' },
  { key: 'pat_dark',    bg: '#18181b' },
  { key: 'pat_pink',    bg: 'linear-gradient(135deg,#be185d,#ec4899,#f9a8d4)' },
];

function initSwatches() {
  const grid = document.getElementById('swatch-grid');
  grid.innerHTML = '';
  patternDefs.forEach((p,i) => {
    const name = t(p.key);
    const el = document.createElement('div');
    el.className = 'swatch' + (i===selectedPattern?' active':'');
    el.title = name;
    let s = `background:${p.bg};width:100%;`;
    if(p.extra) s += `background-image:${p.extra};`;
    el.setAttribute('style', s);
    el.innerHTML = `<div class="swatch-label">${name}</div>`;
    el.onclick = () => { selectedPattern = i; initSwatches(); };
    grid.appendChild(el);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ACCORDION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleAcc(id) { document.getElementById(id).classList.toggle('open'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TABS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function switchTab(mode) {
  backMode = mode;
  document.querySelectorAll('.tab-btn').forEach((b,i) =>
    b.classList.toggle('active', (i===0&&mode==='preset')||(i===1&&mode==='custom')));
  document.getElementById('tab-preset').classList.toggle('active', mode==='preset');
  document.getElementById('tab-custom').classList.toggle('active', mode==='custom');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SLIDERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function onSlider(el, valId, suffix) {
  try { updateRangeVisual(el); } catch(e) {}
  document.getElementById(valId).textContent = el.value + ' ' + suffix;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BORDER STYLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setBorderStyle(btn) {
  document.querySelectorAll('#border-style-group .icon-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  borderStyleVal = btn.dataset.val;
  const show = borderStyleVal !== 'none';
  document.getElementById('border-thickness-field').style.display = show ? '' : 'none';
  document.getElementById('border-color-field').style.display = show ? '' : 'none';
  updatePreview();
initSliderFx();
initStartModal();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PDF ORIENTATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setOrient(btn) {
  document.querySelectorAll('#orient-group .icon-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  pdfOrient = btn.dataset.val;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RADIUS TOGGLE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleRadius() {
  radiusEnabled = !radiusEnabled;
  document.getElementById('radius-toggle').classList.toggle('on', radiusEnabled);
  document.getElementById('radius-field').style.display = radiusEnabled ? '' : 'none';
  updatePreview();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LIVE PREVIEW
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updatePreview() {
  const bw = borderStyleVal === 'none' ? 0 : parseInt(document.getElementById('border-w').value);
  const bc = document.getElementById('border-color').value;
  const ip = parseInt(document.getElementById('inner-pad').value);
  const om = parseInt(document.getElementById('outer-mar').value);
  const r  = radiusEnabled ? parseInt(document.getElementById('border-radius').value) : 0;
  const mini = document.getElementById('card-mini');
  const inner = document.getElementById('card-mini-inner');
  const scale = 90;
  const cardSize = parseInt(document.getElementById('size-select').value);
  const f = scale / cardSize;
  const omS = om * f, bwS = bw * f, ipS = ip * f, rS = r * f;

  mini.style.cssText = 'position:absolute;inset:0;background:white;';
  if (borderStyleVal === 'hatched') {
    mini.style.position = 'absolute';
    mini.style.inset = omS + 'px';
    mini.style.borderRadius = rS + 'px';
    mini.style.background = `repeating-linear-gradient(45deg,transparent 0,transparent 3px,${bc} 3px,${bc} 4px),repeating-linear-gradient(-45deg,transparent 0,transparent 3px,${bc} 3px,${bc} 4px)`;
    inner.style.cssText = `position:absolute;top:${bwS}px;left:${bwS}px;right:${bwS}px;bottom:${bwS}px;border-radius:${Math.max(0,rS-bwS)}px;background:linear-gradient(135deg,#ddd,#eee);display:flex;align-items:center;justify-content:center;font-size:1.2rem;padding:${ipS}px;`;
  } else {
    const bCSS = borderStyleVal === 'none' ? 'none' : `${bwS}px ${borderStyleVal} ${bc}`;
    mini.style.position = 'absolute';
    mini.style.inset = omS + 'px';
    mini.style.borderRadius = rS + 'px';
    mini.style.border = bCSS;
    mini.style.background = 'transparent';
    inner.style.cssText = `position:absolute;inset:${ipS}px;border-radius:${Math.max(0,rS-bwS-ipS)}px;background:linear-gradient(135deg,#ddd,#eee);display:flex;align-items:center;justify-content:center;font-size:1.2rem;`;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CARD PARAMS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getCardParams() {
  return {
    cardPx:   parseInt(document.getElementById('size-select').value),
    cols:     parseInt(document.getElementById('cols-select').value),
    bStyle:   borderStyleVal,
    bWidth:   borderStyleVal === 'none' ? 0 : parseInt(document.getElementById('border-w').value),
    bColor:   document.getElementById('border-color').value,
    innerPad: parseInt(document.getElementById('inner-pad').value),
    outerMar: parseInt(document.getElementById('outer-mar').value),
    gap:      parseInt(document.getElementById('card-gap').value),
    sheetPad: parseInt(document.getElementById('sheet-pad').value),
    radius:   radiusEnabled ? parseInt(document.getElementById('border-radius').value) : 0,
  };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAKE CARD CELL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function makeCardCell(contentFn, p) {
  const cellSize = p.cardPx + p.gap;
  const cell = document.createElement('div');
  cell.className = 'grid-cell';
  cell.style.cssText = `width:${cellSize}px;height:${cellSize}px;`;
  const inset = p.outerMar + p.gap / 2;
  const bodySize = p.cardPx - p.outerMar * 2;
  const body = document.createElement('div');
  body.className = 'card-body';
  body.style.cssText = `top:${inset}px;left:${inset}px;width:${bodySize}px;height:${bodySize}px;border-radius:${p.radius}px;`;
  if (p.bStyle === 'hatched') {
    body.style.background = `repeating-linear-gradient(45deg,transparent 0,transparent 4px,${p.bColor} 4px,${p.bColor} 6px),repeating-linear-gradient(-45deg,transparent 0,transparent 4px,${p.bColor} 4px,${p.bColor} 6px)`;
    const cw = document.createElement('div');
    cw.style.cssText = `position:absolute;top:${p.bWidth}px;left:${p.bWidth}px;right:${p.bWidth}px;bottom:${p.bWidth}px;border-radius:${Math.max(0,p.radius-p.bWidth)}px;overflow:hidden;padding:${p.innerPad}px;background:white;`;
    contentFn(cw, p); body.appendChild(cw);
  } else {
    if (p.bStyle !== 'none') body.style.border = `${p.bWidth}px ${p.bStyle} ${p.bColor}`;
    body.style.padding = p.innerPad + 'px';
    body.style.overflow = 'hidden';
    contentFn(body, p);
  }
  cell.appendChild(body);
  return cell;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FRONT IMAGE UPLOAD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const frontDz = document.getElementById('front-dz');
const frontInput = document.getElementById('front-input');
frontDz.onclick = () => frontInput.click();
frontInput.onchange = e => handleFrontFiles(e.target.files);
frontDz.ondragover = e => { e.preventDefault(); frontDz.classList.add('over'); };
frontDz.ondragleave = () => frontDz.classList.remove('over');
frontDz.ondrop = e => { e.preventDefault(); frontDz.classList.remove('over'); handleFrontFiles(e.dataTransfer.files); };

function handleFrontFiles(files) {
  const valid = Array.from(files).filter(f => f.type.startsWith('image/'));
  if (!valid.length) return;
  const remaining = 64 - images.length;
  if (remaining <= 0) { toast(t('toast_max')); return; }
  const toLoad = valid.slice(0, remaining);
  let done = 0;
  toLoad.forEach(f => {
    const r = new FileReader();
    r.onload = e => {
      images.push({ id: Date.now()+Math.random(), src: e.target.result });
      if (++done === toLoad.length) { renderThumbs(); updateBadge(); toast(t('toast_added', {n: done})); }
    };
    r.readAsDataURL(f);
  });
}

function renderThumbs() {
  const grid = document.getElementById('thumb-grid');
  grid.innerHTML = '';
  images.forEach((img,idx) => {
    const d = document.createElement('div');
    d.className = 'thumb';
    d.innerHTML = `<img src="${img.src}"><button class="del" onclick="removeImg(${idx})">‚úï</button>`;
    grid.appendChild(d);
  });
  const bar = document.getElementById('counter-bar');
  if (images.length) {
    bar.style.display = 'block';
    document.getElementById('img-count').textContent = images.length;
    document.getElementById('card-count').textContent = images.length * 2 + ' (' + images.length + ')';
  } else { bar.style.display = 'none'; }
  frontInput.value = '';
}
function updateBadge() { document.getElementById('num-1').classList.toggle('done', images.length > 0); }
function removeImg(idx) { images.splice(idx,1); renderThumbs(); updateBadge(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BACK IMAGE UPLOAD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const backDzEl = document.getElementById('back-dz');
const backInput = document.getElementById('back-input');
backDzEl.onclick = e => { if(e.target!==backInput) backInput.click(); };
backInput.onchange = e => {
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader();
  r.onload = ev => {
    customBackSrc = ev.target.result;
    document.getElementById('back-preview').src = customBackSrc;
    document.getElementById('back-preview').style.display = 'block';
    document.getElementById('back-remove-btn').style.display = 'block';
    toast(t('toast_back_ok'));
  };
  r.readAsDataURL(f);
};
function removeBackImage() {
  customBackSrc = null;
  document.getElementById('back-preview').style.display = 'none';
  document.getElementById('back-remove-btn').style.display = 'none';
  backInput.value = '';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GENERATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function generate() {
  if (!images.length) { toast(t('toast_no_images')); return; }
  if (backMode === 'custom' && !customBackSrc) { toast(t('toast_no_back')); return; }
  if (images.length > 32) {
    document.getElementById('warn-body-text').innerHTML = t('warn_body', {pairs: images.length, cards: images.length*2});
    document.getElementById('warn-overlay').classList.add('visible');
    return;
  }
  doGenerate();
}

function confirmGenerate() { closeWarn(); doGenerate(); }
function closeWarn() { document.getElementById('warn-overlay').classList.remove('visible'); }


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// A4 AUTO-FIT + AUTO-PAGINATION (print-safe)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const A4_MM = { w: 210, h: 297 };
const PRINT_MARGIN_MM = 8;                  // must match @media print @page margin
const CSS_PX_PER_MM = 96 / 25.4;

// Conservative layout constants (for print):
const PRINT_LEFT_SCISSORS_W = 16;           // left "‚úÇ" column width approximation
const PRINT_TOP_SCISSORS_H = 22;            // top "‚úÇ" row height approximation
const PRINT_GRID_BORDER = 2;                // top + left dashed border thickness
const PRINT_CELL_BORDER = 2;                // each cell right/bottom dashed border thickness
const PRINT_SAFETY_W = 10;                  // extra buffer against printer/browser quirks
const PRINT_SAFETY_H = 12;                  // extra buffer against printer/browser quirks

function getPrintableA4Px() {
  return {
    w: (A4_MM.w - 2 * PRINT_MARGIN_MM) * CSS_PX_PER_MM,
    h: (A4_MM.h - 2 * PRINT_MARGIN_MM) * CSS_PX_PER_MM,
  };
}

function estimateGridWidthPx(p) {
  const cellOuterW = (p.cardPx + p.gap) + PRINT_CELL_BORDER; // content width + right border
  return PRINT_LEFT_SCISSORS_W + PRINT_GRID_BORDER + (p.cols * cellOuterW);
}

function estimateRowsPerA4(p) {
  const page = getPrintableA4Px();
  const rowOuterH = (p.cardPx + p.gap) + PRINT_CELL_BORDER;  // content height + bottom border
  const usable = page.h - PRINT_TOP_SCISSORS_H - PRINT_GRID_BORDER - PRINT_SAFETY_H;
  return Math.max(1, Math.floor(usable / rowOuterH));
}

function calcMaxCardPxForA4Width(p) {
  const page = getPrintableA4Px();
  const usableForCols = page.w - PRINT_LEFT_SCISSORS_W - PRINT_GRID_BORDER - PRINT_SAFETY_W;
  const maxCellContent = Math.floor(usableForCols / p.cols) - PRINT_CELL_BORDER; // remove per-cell border
  return Math.max(20, maxCellContent - p.gap); // remove gap to get cardPx
}

function roundDownToStep(val, step = 5) {
  return Math.max(step, Math.floor(val / step) * step);
}

function autoFitCardSizeForA4(baseP) {
  const p = { ...baseP };
  const original = p.cardPx;

  // Width-first fit (most common reason for split/overflow on print)
  let target = Math.min(p.cardPx, calcMaxCardPxForA4Width(p));
  target = roundDownToStep(target, 5);

  // Ensure at least one row fits vertically too (usually already true)
  p.cardPx = Math.max(20, target);
  while (p.cardPx > 20 && estimateRowsPerA4(p) < 1) {
    p.cardPx = Math.max(20, p.cardPx - 5);
  }

  // Final safety: if width still too large due to rounding, decrement by step.
  while (p.cardPx > 20 && estimateGridWidthPx(p) > (getPrintableA4Px().w - PRINT_SAFETY_W)) {
    p.cardPx = Math.max(20, p.cardPx - 5);
  }

  return {
    p,
    changed: p.cardPx !== original,
    originalCardPx: original,
    fittedCardPx: p.cardPx
  };
}

function paginateCards(cards, p) {
  const rowsPerPage = estimateRowsPerA4(p);
  const pageSize = Math.max(p.cols, rowsPerPage * p.cols);
  const pages = [];

  for (let i = 0; i < cards.length; i += pageSize) {
    const slice = cards.slice(i, i + pageSize);
    while (slice.length < pageSize) slice.push(null); // pad last page (duplex alignment)
    pages.push(slice);
  }
  return { pages, rowsPerPage, pageSize };
}

function syncAutoCardSizeUI(px) {
  const sizeEl = document.getElementById('size-select');
  const sizeVal = document.getElementById('size-val');
  if (!sizeEl) return;

  // Respect slider limits in UI (internal logic can still use fitted px if needed)
  const min = parseInt(sizeEl.min || '0', 10);
  const max = parseInt(sizeEl.max || '9999', 10);
  const uiPx = Math.max(min, Math.min(max, px));

  sizeEl.value = String(uiPx);
  if (sizeVal) sizeVal.textContent = `${uiPx} px`;

  // Keep preview in sync with what the user will print
  if (typeof updatePreview === 'function') updatePreview();
}

function doGenerate() {
  const baseP = getCardParams();
  const doubled = shuffle([...images, ...images]);

  // 1) Auto-fit card size to printable A4 width (prevents splitting/scaling)
  const fit = autoFitCardSizeForA4(baseP);
  const p = fit.p;

  // 2) Auto-pagination by rows per A4 page (front/back pairs)
  const { pages, rowsPerPage } = paginateCards(doubled, p);

  document.getElementById('empty-state').style.display = 'none';
  const wrapper = document.getElementById('sheets-wrapper');
  wrapper.style.display = 'flex';
  wrapper.innerHTML = '';

  pages.forEach((pageCards, idx) => {
    const pageNo = idx + 1;
    const total = pages.length;
    wrapper.appendChild(makeFrontSheet(pageCards, p, pageNo, total));
    wrapper.appendChild(makeBackSheet(pageCards, p, pageNo, total));
  });

  if (fit.changed) {
    syncAutoCardSizeUI(p.cardPx);
    toast(`${t('toast_generated', {n: images.length})} ‚Ä¢ ${pages.length}√ó A4 ‚Ä¢ auto size ${fit.originalCardPx}px ‚Üí ${fit.fittedCardPx}px`);
  } else {
    toast(`${t('toast_generated', {n: images.length})} ‚Ä¢ ${pages.length}√ó A4 ‚Ä¢ ${rowsPerPage} rows/A4`);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FRONT SHEET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function makeFrontSheet(cards, p, pageNo = 1, totalPages = 1) {
  const block = document.createElement('div');
  block.className = 'sheet-block';
  const rows = Math.ceil(cards.length / p.cols);
  block.innerHTML = `
    <div class="sheet-header">
      <span class="sheet-badge">${t('sheet_front')}</span>
      <span class="sheet-info">${t('sheet_info_front',{n:cards.filter(Boolean).length,r:rows,c:p.cols})}</span>
      <span class=\"sheet-info\" style=\"margin-left:auto;opacity:.75;\">${t('page_of',{p:pageNo,t:totalPages})}</span>
      <span class="sheet-tip">${t('sheet_list1')}</span>
    </div>`;
  const body = document.createElement('div');
  body.className = 'sheet-body';
  body.style.padding = p.sheetPad + 'px';
  body.appendChild(buildGrid(cards, p, (card) => (container) => {
    if (!card || !card.src) return;
    const img = document.createElement('img');
    img.src = card.src; img.draggable = false;
    img.style.cssText = 'width:100%;height:100%;object-fit:cover;display:block;border-radius:inherit;';
    container.appendChild(img);
  }));
  const note = document.createElement('div');
  note.className = 'print-note';
  note.innerHTML = t('note_front');
  body.appendChild(note);
  block.appendChild(body);
  return block;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BACK SHEET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function makeBackSheet(cards, p, pageNo = 1, totalPages = 1) {
  const block = document.createElement('div');
  block.className = 'sheet-block';
  const rows = Math.ceil(cards.length / p.cols);
  const mirrored = [];
  for (let r = 0; r < rows; r++) {
    const row = cards.slice(r * p.cols, r * p.cols + p.cols);
    mirrored.push(...[...row].reverse());
  }
  block.innerHTML = `
    <div class="sheet-header">
      <span class="sheet-badge back">${t('sheet_back')}</span>
      <span class="sheet-info">${t('sheet_info_back',{n:cards.filter(Boolean).length})}</span>
      <span class=\"sheet-info\" style=\"margin-left:auto;opacity:.75;\">${t('page_of',{p:pageNo,t:totalPages})}</span>
      <span class="sheet-tip back">${t('sheet_list2')}</span>
    </div>`;
  const body = document.createElement('div');
  body.className = 'sheet-body';
  body.style.padding = p.sheetPad + 'px';
  body.appendChild(buildGrid(mirrored, p, (_card) => (container) => {
    if (backMode === 'custom' && customBackSrc) {
      const img = document.createElement('img');
      img.src = customBackSrc; img.draggable = false;
      img.style.cssText = 'width:100%;height:100%;object-fit:cover;display:block;border-radius:inherit;';
      container.appendChild(img);
    } else {
      const pat = patternDefs[selectedPattern];
      container.style.background = pat.bg;
      if (pat.extra) container.style.backgroundImage = pat.extra;
      container.style.backgroundSize = 'cover';
    }
  }));
  const note = document.createElement('div');
  note.className = 'print-note';
  note.innerHTML = t('note_back');
  body.appendChild(note);
  block.appendChild(body);
  return block;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BUILD GRID  (rows rendered as separate divs ‚Üí no split on print)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildGrid(cards, p, contentFnFactory) {
  const cellSize = p.cardPx + p.gap;
  const rows = Math.ceil(cards.length / p.cols);

  const wrapper = document.createElement('div');
  wrapper.className = 'grid-wrapper';
  wrapper.style.overflowX = 'auto';

  const outer = document.createElement('div');
  outer.className = 'cut-outer';

  // ‚îÄ‚îÄ left scissors column ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const scMarg = document.createElement('div');
  scMarg.className = 'scissors-margin';
  for (let r = 0; r < rows; r++) {
    const s = document.createElement('div');
    s.className = 'scissors-row';
    s.textContent = '‚úÇ';
    s.style.height = cellSize + 'px';
    scMarg.appendChild(s);
  }
  outer.appendChild(scMarg);

  // ‚îÄ‚îÄ right column: top scissors + rows ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const colWrap = document.createElement('div');
  colWrap.className = 'cut-cols';

  // top scissors
  const topSc = document.createElement('div');
  topSc.className = 'col-scissors';
  const colCount = p.cols; // keep a stable column count (helps A4 pagination + duplex alignment)
  for (let c = 0; c < colCount; c++) {
    const s = document.createElement('div');
    s.className = 'col-scissors-cell';
    s.textContent = '‚úÇ';
    s.style.width = cellSize + 'px';
    topSc.appendChild(s);
  }
  colWrap.appendChild(topSc);

  // grid container (left + top border only)
  const gridWrap = document.createElement('div');
  gridWrap.className = 'cut-grid-wrap';

  for (let r = 0; r < rows; r++) {
    const rowEl = document.createElement('div');
    rowEl.className = 'cut-row';

    const rowCards = cards.slice(r * p.cols, r * p.cols + p.cols);
    rowCards.forEach(card => {
      rowEl.appendChild(makeCardCell(contentFnFactory(card), p));
    });

    // pad row with empty cells so each printed page keeps a perfect rectangle
    for (let k = rowCards.length; k < p.cols; k++) {
      rowEl.appendChild(makeCardCell(() => {}, p));
    }
    gridWrap.appendChild(rowEl);
  }

  colWrap.appendChild(gridWrap);
  outer.appendChild(colWrap);
  wrapper.appendChild(outer);
  return wrapper;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length-1; i>0; i--) { const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
  return a;
}

function clearAll() {
  images = []; renderThumbs(); updateBadge();
  customBackSrc = null;
  document.getElementById('back-preview').style.display = 'none';
  document.getElementById('back-remove-btn').style.display = 'none';
  document.getElementById('empty-state').style.display = 'flex';
  const w = document.getElementById('sheets-wrapper');
  w.style.display = 'none'; w.innerHTML = '';
  toast(t('toast_cleared'));
}

function doPrint() {
  if (!document.getElementById('sheets-wrapper').children.length) { toast(t('toast_print_first')); return; }
  window.print();
}

function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 2600);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SAVE AS PDF
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function savePDF() {
  const sheets = document.querySelectorAll('#sheets-wrapper .sheet-block');
  if (!sheets.length) { toast(t('toast_print_first')); return; }
  const overlay = document.getElementById('pdf-overlay');
  const fillEl  = document.getElementById('pdf-progress-fill');
  const labelEl = document.getElementById('pdf-progress-label');
  const subEl   = document.getElementById('pdf-sub');
  function setProgress(pct, msg) {
    fillEl.style.width = pct + '%';
    labelEl.textContent = pct + ' %';
    if (msg) subEl.textContent = msg;
  }
  overlay.classList.add('visible');
  setProgress(0, t('pdf_init'));
  await new Promise(r => setTimeout(r, 80));
  try {
    const { jsPDF } = window.jspdf;
    const isLandscape = pdfOrient === 'landscape';
    const pdf = new jsPDF({ orientation: pdfOrient, unit: 'mm', format: 'a4' });
    // A4: portrait = 210√ó297, landscape = 297√ó210
    const pageW = isLandscape ? 297 : 210;
    const pageH = isLandscape ? 210 : 297;
    const margin = 8;
    const total = sheets.length;
    for (let i = 0; i < total; i++) {
      const sheet = sheets[i];
      setProgress(Math.round((i / total) * 80), t('pdf_processing', {i: i+1, total}));
      const header = sheet.querySelector('.sheet-header');
      const note   = sheet.querySelector('.print-note');
      const hd = header ? header.style.display : null;
      const nd = note   ? note.style.display   : null;
      if (header) header.style.display = 'none';
      if (note)   note.style.display   = 'none';
      const canvas = await html2canvas(sheet, {
        scale: 3, useCORS: true, allowTaint: true, backgroundColor: '#ffffff', logging: false, imageTimeout: 30000,
        onclone: (cloneDoc) => {
          cloneDoc.querySelectorAll('.cut-grid,.grid-cell').forEach(el => { el.style.borderStyle='solid'; el.style.borderColor='#BBBBBB'; });
          cloneDoc.querySelectorAll('.scissors-row,.col-scissors-cell,.scissors-margin').forEach(el => { el.style.display='none'; });
        }
      });
      if (header) header.style.display = hd ?? '';
      if (note)   note.style.display   = nd ?? '';
      if (i > 0) pdf.addPage();
      // Fit canvas into page respecting orientation
      const availW = pageW - margin * 2;
      const availH = pageH - margin * 2;
      const cr = canvas.width / canvas.height;
      const ar = availW / availH;
      let imgW, imgH;
      if (cr > ar) { imgW = availW; imgH = availW / cr; }
      else         { imgH = availH; imgW = availH * cr; }
      const x = margin + (availW - imgW) / 2;
      const y = margin + (availH - imgH) / 2;
      pdf.addImage(canvas.toDataURL('image/jpeg', 0.95), 'JPEG', x, y, imgW, imgH);
      pdf.setFontSize(7); pdf.setTextColor(180,180,180);
      const lbl = i%2===0 ? t('pdf_label_front',{n:Math.floor(i/2)+1}) : t('pdf_label_back',{n:Math.floor(i/2)+1});
      pdf.text(lbl, pageW/2, pageH-3, {align:'center'});
    }
    setProgress(95, t('pdf_saving'));
    await new Promise(r => setTimeout(r, 100));
    const title = (document.getElementById('game-title').value || 'pexeso').replace(/\s+/g,'-');
    pdf.save(`${title}.pdf`);
    setProgress(100, t('pdf_done'));
    await new Promise(r => setTimeout(r, 700));
    toast(t('toast_pdf_saved'));
  } catch (err) {
    console.error('PDF error:', err);
    toast(t('toast_pdf_error'));
  } finally {
    overlay.classList.remove('visible');
    setProgress(0, t('pdf_preparing'));
  }
}


// üéöÔ∏è Slider FX helpers (progress fill + active state)
function updateRangeVisual(el){
  if (!el || el.type !== 'range') return;
  const min = Number(el.min || 0);
  const max = Number(el.max || 100);
  const val = Number(el.value || 0);
  const pct = max > min ? ((val - min) * 100) / (max - min) : 0;
  el.style.setProperty('--range-fill', `${Math.max(0, Math.min(100, pct))}%`);

  // optional pulse on nearby value label (works with existing onSlider(...,'foo-val',...))
  const oninputAttr = el.getAttribute('oninput') || '';
  const m = oninputAttr.match(/'([^']*-val)'/);
  if (m) {
    const label = document.getElementById(m[1]);
    if (label) {
      label.classList.add('range-value-pulse');
      clearTimeout(label._rangePulseTimer);
      label._rangePulseTimer = setTimeout(() => label.classList.remove('range-value-pulse'), 120);
    }
  }
}

function initSliderFx(){
  const ranges = Array.from(document.querySelectorAll('input[type="range"]'));
  ranges.forEach(r => {
    updateRangeVisual(r);

    if (!r.dataset.rangeFxBound) {
      r.addEventListener('input', () => updateRangeVisual(r));
      r.addEventListener('change', () => updateRangeVisual(r));
      r.addEventListener('pointerdown', () => r.classList.add('range-active'));
      r.addEventListener('pointerup', () => r.classList.remove('range-active'));
      r.addEventListener('pointercancel', () => r.classList.remove('range-active'));
      r.addEventListener('blur', () => r.classList.remove('range-active'));
      r.dataset.rangeFxBound = '1';
    }
  });
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê=
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Detect saved language or browser language
const savedLang = localStorage.getItem('pexeso-lang');
const browserLang = navigator.language.slice(0,2);
const supported = ['cs','en','sk','pl','de'];
currentLang = savedLang || (supported.includes(browserLang) ? browserLang : 'cs');

setLang(currentLang);
initSwatches();
setBorderStyle(document.querySelector('#border-style-group .icon-btn'));
// Set default game title in detected language
document.getElementById('game-title').value = t('default_title');
updatePreview();
</script>
</body>
</html>
